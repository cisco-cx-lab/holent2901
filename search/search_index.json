{
    "docs": [
        {
            "location": "/",
            "text": "HOLENT-2901\n\n\nWelcome to Cisco Live HOLENT-2901: Advanced SD-WAN Lab\n\n\nPreface\n\n\nThis document describes the Cisco SD-WAN Advanced Lab.\n\n\nAudience\n\n\nThis document is intended for use by attendees of the Cisco Live 2021 who are taking the SD-WAN Advanced Lab (HOLENT-2901).\n\n\nSpeakers\n\n\n\n\nEric Wang \nCustomer Delivery Architect\n\n\nLei Tian \nCustomer Delivery Architect",
            "title": "Home"
        },
        {
            "location": "/#holent-2901",
            "text": "Welcome to Cisco Live HOLENT-2901: Advanced SD-WAN Lab",
            "title": "HOLENT-2901"
        },
        {
            "location": "/#preface",
            "text": "This document describes the Cisco SD-WAN Advanced Lab.",
            "title": "Preface"
        },
        {
            "location": "/#audience",
            "text": "This document is intended for use by attendees of the Cisco Live 2021 who are taking the SD-WAN Advanced Lab (HOLENT-2901).",
            "title": "Audience"
        },
        {
            "location": "/#speakers",
            "text": "Eric Wang  Customer Delivery Architect  Lei Tian  Customer Delivery Architect",
            "title": "Speakers"
        },
        {
            "location": "/access/",
            "text": "About this lab\n\n\nIn this lab, you will be introduced with advanced SD-WAN topics including advanced routing, central control policy, QoS, per-tunnel QoS, Direct Internet Access, Cloud OnRamp for SaaS, Dynamic tunneling. The lab will be built with Network Function Virtualization for Viptela and IOS XE SD-WAN image.\n\n\nLab Flow\n\n\nIn this lab, you will follow the lab guide to configure:\n\n\n\n\nAdvanced Routing\n\n\nMigration\n\n\nPerformance & Optimization\n\n\n\n\nLab Access\n\n\nBelow table provides the IP addresses and credentials for the devices used in this lab:\n\n\n\n\n\n\n\n\nDevice\n\n\nIP\n\n\nUsername\n\n\nPassword\n\n\n\n\n\n\n\n\n\n\nvManage\n\n\n198.18.133.200:19001\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nvbond\n\n\n198.18.133.200:19002\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nvSmart\n\n\n198.18.133.200:19003\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nDC1-WE1\n\n\n198.18.133.200:19010\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nDC1-WE2\n\n\n198.18.133.200:19009\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nDC2-WE1\n\n\n198.18.133.200:19014\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nDC2-WE2\n\n\n198.18.133.200:19012\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nRH-WE1\n\n\n198.18.133.200:19016\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nR1-WE1\n\n\n198.18.133.200:19017\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nR2-WE1\n\n\n198.18.133.200:19020\n\n\nadmin\n\n\nadmin\n\n\n\n\n\n\nR1-VM1\n\n\n198.18.133.200:19018\n\n\nviptela\n\n\nviptela\n\n\n\n\n\n\nR2-VM1\n\n\n198.18.133.200:19019\n\n\nviptela\n\n\nviptela\n\n\n\n\n\n\n\n\nYou can also login the remote host via VNC.\n\n\n\n\n\n\n\n\nDevice\n\n\nIP\n\n\nUsername\n\n\nPassword\n\n\n\n\n\n\n\n\n\n\nR1-VM1\n\n\n198.18.133.200:30500\n\n\nviptela\n\n\nviptela\n\n\n\n\n\n\nR1-VM1\n\n\n198.18.133.200:30501\n\n\nviptela\n\n\nviptela\n\n\n\n\n\n\n\n\nLab Topology",
            "title": "Lab Access"
        },
        {
            "location": "/access/#about-this-lab",
            "text": "In this lab, you will be introduced with advanced SD-WAN topics including advanced routing, central control policy, QoS, per-tunnel QoS, Direct Internet Access, Cloud OnRamp for SaaS, Dynamic tunneling. The lab will be built with Network Function Virtualization for Viptela and IOS XE SD-WAN image.",
            "title": "About this lab"
        },
        {
            "location": "/access/#lab-flow",
            "text": "In this lab, you will follow the lab guide to configure:   Advanced Routing  Migration  Performance & Optimization",
            "title": "Lab Flow"
        },
        {
            "location": "/access/#lab-access",
            "text": "Below table provides the IP addresses and credentials for the devices used in this lab:     Device  IP  Username  Password      vManage  198.18.133.200:19001  admin  admin    vbond  198.18.133.200:19002  admin  admin    vSmart  198.18.133.200:19003  admin  admin    DC1-WE1  198.18.133.200:19010  admin  admin    DC1-WE2  198.18.133.200:19009  admin  admin    DC2-WE1  198.18.133.200:19014  admin  admin    DC2-WE2  198.18.133.200:19012  admin  admin    RH-WE1  198.18.133.200:19016  admin  admin    R1-WE1  198.18.133.200:19017  admin  admin    R2-WE1  198.18.133.200:19020  admin  admin    R1-VM1  198.18.133.200:19018  viptela  viptela    R2-VM1  198.18.133.200:19019  viptela  viptela     You can also login the remote host via VNC.     Device  IP  Username  Password      R1-VM1  198.18.133.200:30500  viptela  viptela    R1-VM1  198.18.133.200:30501  viptela  viptela",
            "title": "Lab Access"
        },
        {
            "location": "/access/#lab-topology",
            "text": "",
            "title": "Lab Topology"
        },
        {
            "location": "/intro/",
            "text": "Lab Introduction\n\n\n\n\nCompany ACME is a multi-international company where it has branches world wide which include two Data Centers in San Jose and RTP and few regional hubs in different continents as well as remote branches world wide.\n\n\nLab Design\n\n\nThis lab is designed to help you understand various advanced routing features based upon a large multi-international company design. The lab is based on dcloud and simulating ACME's topology with 5 Wan Edges(wEdges). All the basic connectivity as well as feature templates/devices templates have been pre-configured for you. You should be able to go straight to those LAB tasks.\n\n\n\n\nAs shown in the above diagram:\n\n\n\n\nDC1 has two cEdges which connects to three transports\n\n\nDC2 has also two cEdges which connect to three transports as well\n\n\nRH(reginal hub) has one cEdge\n\n\nBoth DC1-WEs and DC2-WEs are running eBGP with DC routers, BGP has been preconfigured for you.\n\n\nRemote1 has one cEdge connecting to private1 and LTE\n\n\nRemote2 has one cEdge connecting to private2 and LTE\n\n\n\n\nLab Access\n\n\nPlease find your anyconnect login from your proctor.\n\n- Connect to anyconnect VPN dcloud-lon-anyconnect.cisco.com with the username and password provided.\n\n\n\n\n\n\nAfter prompted for credentials, use the credentials provided by the lab admin.\n\n\n\n\n\n\n\n\nHit accept when the prompt appears to accept the VPN connection login",
            "title": "Getting Started"
        },
        {
            "location": "/intro/#lab-introduction",
            "text": "Company ACME is a multi-international company where it has branches world wide which include two Data Centers in San Jose and RTP and few regional hubs in different continents as well as remote branches world wide.",
            "title": "Lab Introduction"
        },
        {
            "location": "/intro/#lab-design",
            "text": "This lab is designed to help you understand various advanced routing features based upon a large multi-international company design. The lab is based on dcloud and simulating ACME's topology with 5 Wan Edges(wEdges). All the basic connectivity as well as feature templates/devices templates have been pre-configured for you. You should be able to go straight to those LAB tasks.   As shown in the above diagram:   DC1 has two cEdges which connects to three transports  DC2 has also two cEdges which connect to three transports as well  RH(reginal hub) has one cEdge  Both DC1-WEs and DC2-WEs are running eBGP with DC routers, BGP has been preconfigured for you.  Remote1 has one cEdge connecting to private1 and LTE  Remote2 has one cEdge connecting to private2 and LTE",
            "title": "Lab Design"
        },
        {
            "location": "/intro/#lab-access",
            "text": "Please find your anyconnect login from your proctor. \n- Connect to anyconnect VPN dcloud-lon-anyconnect.cisco.com with the username and password provided.    After prompted for credentials, use the credentials provided by the lab admin.     Hit accept when the prompt appears to accept the VPN connection login",
            "title": "Lab Access"
        },
        {
            "location": "/lab1/",
            "text": "Lab 1: Advanced Routing\n\n\n\n\nIn this section, you will help ACME on advanced routing using local and central policy. You will perform the following tasks.\n\n\n\n\n\n\nACME DC routers have already tagged all the routes originated from DC1 with BGP community of 65010:1000; all the routes originated from DC2 with BGP community of 65020:2000. \nPlease configure a route-policy to ensure default route (0.0.0.0/0) coming from DC to set an OMP tag of 100.\n For DC1 routes, setting an OMP tag of \n1000\n; for DC2 routes, setting an OMP tag of \n2000\n. (Lab_Task 1)\n\n\n\n\n\n\nACME wants to have a \nhub & spoke topology between Remotes and DCs as well between Remotes and Regional hubs\n. Hub & spoke topology will scale more by reducing NO. of tunnels required on the devices. (Lab_Task 2)\n\n\n\n\n\n\nACME has categorized their branches into multiple Business Units(BUs). In the Data Center (DC) sites, the headend WAN Edges(WEs) are also categorized into multiple BUs for horizontal scaling purpose in terms of throughputs, therefore remote site only needs to build tunnels to its respective DC hub WEs. \nRemote Site1 only needs to build tunnels to DC1-WE1 and DC2-WE2\n; on the contrary, \nRemote Site 2 only needs to build tunnels to DC1-WE2 and DC2-WE2\n.(Lab_Task 2)\n\n\n\n\n\n\nRemote sites receive default route from both RH and DC, \nDCs will be preferred and load shared\n. If RH goes down, DCs are load shared for default(Lab_Task 3)\n\n\n\n\n\n\nchange to \n- Remote sites receive default route from both RH and DC, \nDCs will be preferred and load shared. RH's default will be used as backup for DCs. (Lab_Task 3)**\n\n\n\n\n\n\nRemotes sites receive more specific routes from both DCs, \nroutes originated from local DC are preferred\n, if one DC goes down, it will use the routes from another DC as backup. In another words, from remote sites perspective, previously routes tagged with 1000 will prefer DC1; routes tagged with 2000 will prefer DC2.(Lab_Task 4)\n\n\n\n\n\n\nFor remote sites to any other regional routes are forced to go through DC\u2019s functional hub. For \nremote site1, it goes through WE1 in DC1 and DC2\n; for \nremote site 2, it goes through WE2 in DC1 and DC2\n.(Lab_Task 4)\n\n\n\n\n\n\nNote: In these lab exercises, it's possible that there are multiple ways to achieve the requirements. The lab guide provides a detailed step by step instruction for each taks. However you're welcomed to solve it with your own solution. Just be mindful with the time.\n\n\nTask 1: Local Route Policy\n\n\nStep 1.1\n Verification of the routes received on DC WEs.\n\n\n\n\nSSH to \nDC1-WE1\n (repeat the same on DC1-WE2,DC2-WE1,DC2-WE2,R1-WE1 and R2-WE2 as well) and do \nshow ip route vrf 1\n and make sure \n10.100.100.0/24, 10.200.200/24\n as well as \n0.0.0.0/0\n learned via BGP.\n\n\n\n\n\n\nStep 1.2\n Verify the BGP communities.\n\n\n\n\n10.100.100.0/24 should tag with 65010:1000; 10.200.200.0/24 should tag with 65020:2000. Execute \nshow ip bgp vpnv4 vrf 1 <prefix>\n (10.100.100.0/24 and 10.200.200.0/24) on DC1-WE1,WE2 and DC2-WE1,WE2.\n\n\n\n\n\n\nStep 1.3\n set OMP tag for DC specific Routes\n\n\n\n\nlogin vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies\n\n\nClick \nCustom Options\n drop down on the top right and select \nRoute Policy\n under \nLocalized Policy\n\n\nClick \nAdd Route Policy\n to Create new\n\n\nName: \nLAB_DCs_BGP_RP\n  (write down this name, it will be used later)\n\n\nDescription: \nLAB_DCs_BGP_RP\n\n\n\n\nClick \n+Sequence Type\n on the left then click \n+Sequence Rule\n, click Match, select Address, select \ndefault\n. \n\n\n\n\n\n\n\n\nClick \nAction\n, change to \nAccept\n, then select OMP tag, key in \n100\n, then save Match and Actions.\n\n\n\n\n\n\n\nclick \nSequence Rule\n to create following two rules:\n\n\n\n\nMatch \ncommunity-list DC1_Routes\n, \nAccept\n and Set \nTag 1000\n\n\nMatch \ncommunity-list DC2_Routes\n, \nAccept\n and Set \nTag 2000\n  \n\n\nThen click on Save Route Policy\n\n\n\n\n\n\n\n\n\nStep 1.4\n Creating a Local Policy\n\n\n\n\nlogin vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies\n\n\nClick on \nLocalized Policy\n, then click on \nAdd Policy\n\n\n\n\n\n\n\n\nClick on Next to proceed till you see \nConfigure Route Policy\n; click \nAdd Route Policy\n then select \nImport Existing Policy\n; Select \nLAB_DCs_BGP_RP\n click import\n\n\n\n\n\n\n\n\nClick on Next, Key in\n\n\nPolicy Name: \nLAB_DCs_Local_policy\n\n\nPolicy Description: \nLAB_DCs_Local_policy\n .\n\n\nCheck \nNetflow, Application\n and \nImplicit ACL Logging\n.\n\n\nThen click on Save Policy (Feel free to click Preview before save)\n\n\n\n\n\n\nStep 1.5\n apply the route-policy\n\n\n\n\nAccess feature template configuration from \nConfiguration - Templates - Feature\n\n\nLocate feture template \nLab_DC_VPN1_BGP_V01\n and select three dots then click \nEdit\n.\n\n\n\n\n\n\n\n\nSelect \nNeighbor\n section, then click on the pencil icon under Action.\n\n\n\n\n\n\n\n\n\n\nUpdate the following:\n\n\n\n\n\n\nAddress Family\n changes to Global and set to \nOn\n\n\n\n\nAddress Family\n changes to Global and set to \nipv4-unicast\n\n\nRoute Policy In\n changes to Global and set to \nOn\n\n\nPolicy Name\n changes to Global and set to \nLAB_DCs_BGP_RP\n\n(this was the name you wrote down earlier)\n\n\nthen click on Save changes and Click on Update\n\n\n\n\n\n\n\n\nThen click Next, feel free to review the config changes, then click Configure Devices, then check the Confim configuration box and click on OK.\n\n\n\n\n\n\nStep 1.6\n Verify OMP Tags\n\n\n\n\nSSH to DC wEdge routers(\nDC1-WE1,DC1-WE2,DC2-WE1,DC2-WE2\n) and run \nshow ip bgp vpnv4 vrf 1 <prefix>\n (10.100.100.0/24,10.200.200.0/24), you should see proper OMP tags are set\n\n\n\n\n\n\nTask 2: Hub & Spoke Topologies\n\n\nStep 2.1.\n Pre-config verifications\n\n\n\n\nSSH to \nR1-WE1\n and do \nshow sdwan omp route vpn 1\n\n\n\n\n\n\nQuestion: Do you know why the default route learned from private2 shown as invalid and unreachable (Inv,U)\n? \n\n\nThis is because R1-WE1 doesn't have a transport with private 2 color. If you watch the route on R2-WE1, you should notice the next hop from private 1 marked as \n(Inv,U)\n for the same reason where private 1 color doesn't exist on R2-WE1.\n\n\nQuestion: Did you notice the default route is learned from 1.1.30.2 which is the Regional Hub(RH)? Do you know why?\n \n\n\nTo answer this question, we will check the route table at vSmart as all the routes are advertised by vSmart. SSH to vSmart and do \nshow omp route vpn 1 0.0.0.0/0 detail | t\n\n\n\n\nOMP is very much like BGP when it comes down to route preference. In the order of preference, there is a origin-protocol, in this case the default route learned on RH is from Static (by design, in real deployment, probably it's going to be BGP as well); whereas the default learned from DCs is from iBGP. Origin protocol static is more preferred than iBGP.\n\n\nNow, let's look at the specific routes learned from DC. Do \nshow sdwan omp route vpn 1 10.100.100.0/24\n on vSmart.\n\n\n\n\nQuestion: you will see 4 paths and one of the paths shows Inv,U. Hopefully you can answer why it's that. But why there are 4 paths?\n\n\nLet's SSH to vSmart and do \nshow omp route vpn 1 10.100.100.0/24 | t\n.\n\n\n\n\nYou will see 12 ECMP routes marked as \nC,R\n (Chosen,Resolved). Why 12? Because we have 4 DC wEdges each with 3 transports, so total 12 paths. \n\n\nThe next question will be why there are only 4 paths on the remote wEdges? This is because the ECMP settings on the wEdge by default is set to 4. If you change it to 16 (currently 16, it will be increased to 128 in the future release), you will see all 12 paths. \n\n\nNote: vSmart randomly selects 4 paths (or whatever the max ECMP value is set) and install on the device. In a  large deployment where multiple paths is more than 16 (before 128 paths is supported), this may pose problem.\n\n\nIn this exercise we purposely keep the default ECMP setting and learn how to solve this issue with centralized policy.\n\n\nStep 2.2.\n Create a topology for centralized policy\n\n\n\n\n\n\nlogin vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies\n\n\n\n\n\n\nClick \nCustom Options\n drop down on the top right and select \nTopology\n under \nCentralized Policy\n\n\n\n\n\n\nClick \nAdd Topology\n under \nTopology\n and select \nCustom Control(Route&TLOC)\n\n\n\n\n\n\n\n\nYou are going to create two topologies, one for each remote site.\n\n\n\n\nCreate topology policy for Remote1\n\n\nName: \nLAB_Topo_RS1\n\n\nDescription: \nLAB topology for Remote Site 1\n\n\nClick \n+Sequence Type\n and select \nRoute\n\n\nClick \n+Sequence Rule\n, leave unchanged under Match(means match all)\n\n\nClick \nActions\n and change to \nAccept\n (we'll come back and do the routes policy later).\n\n\n\nclick \n+Sequence Type\n then select \nTLOC\n\n\nclick \n+Sequence Rule\n, select \nTLOC\n.\n\n\nUnder \nMatch Conditions\n, selects \nDCs-BU1-TLOCs\n for \nTLOC List\n (this TLOC list has been pre-defined for you which includes all the TLOCs of DC1-WE1 and DC2-WE1\n\n\nClick \nActions\n, change Actions to \nAccept\n\n\nClick \n+Sequence Rule\n, select \nTLOC\n\n\nunder \nMatch Conditions\n, selects \nRH\n for \nTLOC List\n (this TLOC list has been pre-defined for you which includes all the TLOCs of RH)\n\n\n\n\nClick \nActions\n, change Actions to \nAccept\n\n\n\n\n\n\nThen click save Control Policy.\n\n\n\n\n\n\nThis policy effectively allows R1-WE1 to build tunnels to all the DCs-BU1 devices (DC1-WE1 and DC2-WE1) as well as RH, nothing else as the default action is reject.\n\n\n\n\n\n\nFollow the above steps and create another topology for Remote2 with the following settings:\n\n\nName: \nLAB_Topo_RS2\n\n\nDescription: \nLAB topology for Remote Site 2\n\n\nClick \n+Sequence Type\n then select \nRoute\n\n\nClick \n+Sequence Rule\n, leave unchanged under Match(means match all),\n\n\nClick \nActions\n change Actions to \nAccept\n (we'll come back and do the routes policy later).\n\n\n\nClick \n+Sequence Type\n then select \nTLOC\n\n\nclick \n+Sequence Rule\n, select \nTLOC\n.\n\n\nUnder \nMatch Conditions\n, selects \nDCs-BU2-TLOCss\n for \nTLOC List\n (this TLOC list has been pre-defined for you which includes all the TLOCs of DC1-WE2 and DC2-WE2)\n\n\nClick \nActions\n, change Actions to \nAccept\n\n\nClick \n+Sequence Rule\n, select \nTLOC\n\n\nunder \nMatch Conditions\n, selects \nRH\n for \nTLOC List\n (this TLOC list has been pre-defined for you which includes all the TLOCs of RH)\n\n\nClick \nActions\n, change Actions to \nAccept\n\n\nThen click save Control Policy.\n\n\n\n\nThis policy effectively allows R2-WE1 to build tunnels to all the DCs-BU1 devices (DC1-WE2 and DC2-WE2) as well as RH, nothing else as the default action is reject.\n\n\n\n\nStep 2.3.\n Apply the topology policy to Centralized Policy\n\n\n\n\nlogin vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies\n\n\nClick \nAdd Policy\n under \nCentralized Policy\n\n\nClick next, you will see Configure Topology and VPN membership - Click \nAdd topology\n, select \nImport Existing Topology\n\n\nClick \nCustom Control(Route and TLOC)\n, select \nLAB_Topo_RS1\n\n\nClick on Add Topology\n\n\nfollow the above steps to add topology \nLAB_Topo_RS2\n as well\n\n\n\n\n\n\n\n\n\n\nClick Next and Next, you will see Apply Policies to Sites and VPNs,\n\n\n\n\nPolicy Name: LAB_Central_v01\nDescription: Task2 Topo only\nClick New Site List Under LAB_Topo_RS1, under Outbound Site List, select RS1,then click on Add\nClick New Site List Under LAB_Topo_RS2, under Outbound Site List, select RS2,then click on Add\nthen click Save Policy\n\n\n\n\nStep 4.\n Activate the first Centralized Policy\n\n\nGo to Configuration Centralized Policy, click ...(three dots) of our LAB_Centeral_v01, then click on Activate, and Activate. Policy will be pushed to the vSmart.\n\n\n\n\nStep 5.\n Verify the hub & spoke topology where R1-WE1 and R2-WE1 should not have tunnel between them but everyone else.\n\n\nSSH to R1-WE1 & R2-WE1 do show sdwan bfd sessions, you can see no bfd session between R1-WE1 and R2-WE1\n\n\n\n\n\n\n3.3 Lab instructions for task Lab_Task 3 (Default Route handling)\n\n\nStep 1.\n Default Route Handling. The requirement is to prefer the default route learned from DC over RH. We need to modify our Centralized policy so that the default from DC has higher OMP perference over RH. First, let's make a new version of the topology policy, that way, when you update your policy in a production network you can also fall back to the previous version.\n\n\nGo to Configurations->Policies->Centralized Policy, click three dots of LAB_Topo_RS1 and then click Copy.\n\n\n\n\nName: LAB_Topo_RS1_V02\n\n\nDescription: +Default Route handling\n\n\n\n\nStep 2.\n Let's edit the new topology. click Edit under three dots of LAB_Topo_RS1_V02.We're going to add two new rules, rule1: match default & originator of 1.1.10.1(DC1-WE1) then accept and set preference of 100; rule2: match default & originator of 1.1.20.1(DC2-WE1) then accept and set preference of 100; and we need to make sure the sequence of these two new rules are ahead of previous accept all rule as the order on vSmart policy does matter, it will do the lookup based upon the order, if it finds the match, it will use that rule and it won't look for subsequent rule any more. Then click Save policy.\n\n\n\n\nStep 3.\n Let's apply the policy and verify.\n\n\nGo to Configuration->Policies->Centralized Policy, edit(three dots) the current policy(In production deployment, you always want to use the same practice of copying the current policy then apply it. Just demonstrate how to update the current policy works.)\n\n\nSelect Topology, edit LAB_Topo_RS1 then click Detach which will remove this topology.\n\n\n\n\nAdd the new topology we're just created. Click Add Topology,select Import Existing Topology then select LAB_Topo_RS1_V02, then click Import.\n\n\n\n\nClick on Policy Application->New Site List->Outbound Site List, select RS1,then click on ADD, Save Policy Changes, then Activate.\nNote: Outbound and Inbound are from vSmart perspective where outbound policy means how the routes are sent out from vSmart; inbound policy means how the routes are sent to the vSmart.\n\n\n\n\nStep 4.\n Once the policy is activated, let's do some verifications.\nSSH to R1-WE1 and do show sdwan omp route and see the learned TLOC for default  route as well as preference. We're expecting the routes are learned from DC1-WE1 and DC2-WE1 with preference of 100. Oh, no the routes are not changed at all, the three installed routes still learned from RH and no preference set either.Why is that?\n\n\n\n\nLet's check omp route table on the vSmart, SSH to vSmart and do show omp route | t. As you recall, the OMP routes don't have any changes either where 3 paths learned from RH marked with C,R due to routes originated from Static which are preferred over originated from iBGP. But why the outbound policy setting the routes originated from DC1-WE1 and DC2-WE1 doesn't work, this is because outbound policy will only look for the chosen routes with C.R by default, other routes without learned from DCs as they are not chosen without C,R, so those routes are not even going through the outbound policies. There are multiple way of changing this behavior such as using inbound policy or configure send-backup path, or make every route with C.R. We're not going over all the solutions. Let's configure an vSmart inbound policy to make the default routes from DCs have higher OMP preference than RH's. Note: vSmart inbound policy may not be an ideal solution for the senarios. It is recommended to use outbound policy only if an outbound policy can meet the requirements without additional inbound policy for its simplicity and full visibility of vSmart.\n\n\n\n\nStep 5.\n Let's configure an inbound policy by creating a new topology first, go to Configuration->Policies-> Custom Options->Centralized Policy->Topology, then Add Topology->Custom Control with the following settings:\n\n\nName: default_route_from_DC\nDescription: default_route_from_DC\n+Sequence Type: Route\n+Sequence Rule\nMatch->Prefix List: default\nSite List: DCs\nActions->Accept preference:50\nDefault Action: Accept\n\n\nThen Save Control Policy\n\n\n\n\nApply this new topology to the current policy.\n\n\nGo to Configuration->Policies->Centralized Policy, Edit(three Dots)the LAB_Central_v01, Click Add Topology,select Import Existing Topology then select default_route_from_DC, then click Import.\n\n\n\n\nClick on Policy Application->New Site List->Iutbound Site List, select DCs,then click on ADD, Save Policy Changes, then Activate.\nNote:This time is an inbound policy wehre inbound policy controls how the vSmart are seeing the routes.\n\n\n\n\nStep 6.\n SSH to vSmart and do show omp route vpn 1 | t, we can see the routes from DCs are C,R with preference 50 now which is expected.\n\n\n\n\nSSH to R1-WE1 and do show sdwan omp route vpn 1 , we can see 4 paths from DCs with preference 100. Remember the vSmart outbound policy we assign preference of 100 where the inbound policy we assign preference of 50 so that we can differentiate which policy is taking effect.\n\n\n\n\nWell done! You have finished the default route handling task for R1-WE1.Let's do the same policy for R2-WE1.\n\n\nStep 1.\n Go to Configurations->Policies->Centralized Policy, click three dots of LAB_Topo_RS1v02 and change Name and Description to LAB_Topo_RS2v02 then click Copy.\n\n\n\n\nStep 2.\n Modify the topology for R2-WE2.\nselect TLOC as the Sequence Type, edit Rule1, we need to change the TLOC List from BU1 to BU2 as we'd like to use the BU2's functional hub which are DC1-WE2 and DC2-WE2 as the entry point for remote site 2(Remember remote site 2 represents the remote sites for BU2, where remote site 1 represents the remote sites for BU1). Remove the DCs-BU1-TLOCs by clicking the x, then select DCs-BU2-TLOCs instead, then click Save Match and Actions.\n\n\n\n\nSelect Route as the Sequence Type, we need to change the originator from 1.1.10.1 and 1.1.20.2 to 1.1.10.2 and 1.1.20.2 respectively . By doing this, default route from DC1-WE2 and DC2-WE2 will have OMP preference of 100 sent to R2-WE2 site.\n\n\n\n\nStep 3.\n Apply this topology to the Centralized Policy.\nGo to Configurations->Policies->Centralized Policy, Edit LAB_Central_v01.\n\n\n\n\nGo to Topology->Add Topology->Import Existing Topology->Custom Control, then select LAB_Topo_RS2_V02, Import.\n\n\n\n\nRemove the previous RS2 topology by selecting the topology of LAB_Topo_RS2, click detach.\n\n\n\n\nClick Policy Application->Select New Site List under LAB_Topo_RS2_V02, select RS2 as outbound site list, click Add, then save Policy Change, click Activate.\n\n\n\n\nOnce the policy has been pushed to vSmart, let's verify by SSH to R2-WE1 and do show ip route vrf 1. Now, default route has two ECMP paths, one path for each DC.\n\n\n\nLet's do show sdwan omp route vpn 1.You will see that there are 4 paths in the OMP route table, however none of them are valid\n\n\n\n\n3.4 Lab instructions for task Lab_Task 4 (Specific Routes handling)\n\n\nStep 1.\n Now, we're going to control the more specific routes, the goal is to prefer the more specific routes originated from its DC on the remote sites. In the meanwhile, for BU1 (R1-WE1), it only needs to learn the routes from BU1's Headend devices (DC1-WE1, DC2-WE1); for BU2(R2-WE1), it only needs to learn the routes from BU2's Headend devices.\nRemember the specific routes from DC1 already tagged with 1000, from DC2 already tagged with 2000. The idea is to create different policies for BU1 and BU2 sites such that give different OMP preference for different OMP tag.\n\n\nGo to Configuration->Policies->Custom Options->Centralized Policy-> Topology. Let's edit the current topologies (LAB_Topo_RS1_V02 and LAB_Topo_RS2_V02). click Edit under three dots of LAB_Topo_RS1_V02.Select Route as the sequence type,we're going to add four more rules, match OMP Tag 1000 and TLOC of DC1-BU1-TLOCs accept and set preference of 100 ; match OMP Tag 1000 and TLOC of DC2-BU1-TLOCs accept and set preference of 50;  match OMP Tag 2000 and TLOC of DC2-BU1-TLOCs accept and set preference of 100 ; match OMP Tag 2000 and TLOC of DC1-BU1-TLOCs accept and set preference of 50;and we need to make sure the sequence of these rules are ahead of previous accept all rule as the order on vSmart policy does matter, it will do the lookup based upon the order, if it finds the match, it will use that rule and it won't look for subsequent rule any more. Dragging the new rule up and drop the rule in front of the accept all rule (if you follow the lab previously, the new rules should be No. 5, 6,7 and 8, match all rule should be rule No. 9), Then click Save policy and Activate. This will make the vSmart to push the policy immediately after you confirm configuring devices (this is expected as illuted earlier, creating a new policy is a best practice otherwise upating the existing policy will cause the immediate policy push. )\n\n\n\n\nLet's verify. SSH to R1-WE1 and do show sdwan omp route vpn 1, you can see 4 paths for 10.100.100.0/24, however we see 3 paths with preference of 100, 1 path doesn't have preference; and for 10.200.200.0/24, there are 4 paths however 3 paths with preference of 50, 1 path doesn't have preference. If you look at it closely you will notice that the paths picked are from the lowest system-ip.\n\n\n\n\nThis is caused that vSmart by default will only send 4 paths to the wEdges. When vSmart is going through the outbound policy, it takes a route from vsmart route table in the winning order (marked as C,R) and compare it with the outbound policy as long as there is a match (permit) in the policy for a particular prefix, it will send it out and count it as one until it hits the send-path-limits which is 4 by default. Since in our route-policy, we have a permit all at the end which means every route will have a match, therefore first 4 routes in the winning order are sent out regardless which rule they're matching in the policy. There are multiple ways to fix this, the simple way is to change the limit to 16 on both vSmart as well as on the wEdges.\n\n\nStep 2.\n Configure send-path-limit 16 on vSmart\n\n\nGo to Configuration->Templates->Device Template, edit vSmart template, under the OMP config section, add one new command 'send-path-limit 16', then click Update, then Configure Devices.\n\n\n\n\nStep 3.\n Change ecmp-limit to 16 on the wEdges.\n\n\nGo to Configuration->Templates->Feature Template (tab, next to Device Tempalte), search for OMP, and edit Lab_OMP_V01, Under Basic Configuration section look for ECMP limit, change it to Global, and set to 16.Then update, Next, Configure Devices.check Confirm configuration changes on 7 Devices, then  OK.\n\n\n\n\nStep 4.\n Verification.\nSSH to R1-WE1 and do show sdwan omp route vpn 1, you should see each route (10.100.100.0/24 and 10.200.200.0/24) will have 12 paths and 3 paths from prefered DC with preference of 100, 3 paths from secondary DC with preference of 50, another 6 paths from are invalid from other BU hub devices.\n\n\n\n\ndo show ip route vrf 1; you will see 10.100.100.0/0 is leared from 1.1.10.1; 10.200.200.0/24 is learned from 1.1.20.1 whis is desired.\n\n\n\n\nNext, we need to do the same for LAB_Topo_RS2.\n\nStep 5.\n Go to Configuration->Policies->Custom Options->Centralized Policy-> Topology. Click Edit under three dots of LAB_Topo_RS1_V02.Select Route as the sequence type,we're going to add four more rules, match OMP Tag 1000 and TLOC of DC1-BU2-TLOCs accept and set preference of 100 ; match OMP Tag 1000 and TLOC of DC2-BU2-TLOCs accept and set preference of 50;  match OMP Tag 2000 and TLOC of DC2-BU2-TLOCs accept and set preference of 100 ; match OMP Tag 2000 and TLOC of DC1-BU2-TLOCs accept and set preference of 50;and we need to make sure the sequence of these rules are ahead of previous accept all rule as the order on vSmart policy does matter, it will do the lookup based upon the order, if it finds the match, it will use that rule and it won't look for subsequent rule any more. Dragging the new rule up and drop the rule in front of the accept all rule (if you follow the lab previously, the new rules should be No. 5, 6,7 and 8, match all rule should be rule No. 9), Then click Save policy and Activate. This will make the vSmart to push the policy immediately after you confirm configuring devices (this is expected as illuted earlier, creating a new policy is a best practice otherwise upating the existing policy will cause the immediate policy push. )\n\n\n\n\nStep 6.\n Verification.\nSSH to R2-WE1 and do show sdwan omp route vpn 1, you should see each route (10.100.100.0/24 and 10.200.200.0/24) will have 12 paths and 3 paths from prefered DC with preference of 100, 3 paths from secondary DC with preference of 50, another 6 paths from are invalid from other BU hub devices.\n\n\n\n\ndo show ip route vrf 1; you will see 10.100.100.0/0 is leared from 1.1.10.2; 10.200.200.0/24 is learned from 1.1.20.2 whis is desired.\n\n\n\n\nThis concludes the routing handling for the specific routes.\n\n\n3.5 Lab instructions for task Lab_Task 5 (Application Aware Routing)\n\n\nACME wants to provide best user experience for their transactional data ( we will use SSH to simulate that) which has to meet the below SLA requirement. In the mean while, ACME would like to use private 1 as the preferred link, if private 1 doesn't meet the SLA requirement, it will use private 2 when private 2 still meets the SLA. LTE link will only be used when both private 1 and private 2 go down. ACME has the following SLA requirements for their applications.\n\n\n\n\n\n\n\n\nApplication\n\n\nLoss(%)\n\n\nLattency(msec)\n\n\nJitter(msec)\n\n\n\n\n\n\n\n\n\n\nTransactional Data\n\n\n5\n\n\n50\n\n\n100\n\n\n\n\n\n\nBulk-Data\n\n\n10\n\n\n300\n\n\n100\n\n\n\n\n\n\nVoice-and-Video\n\n\n2\n\n\n45\n\n\n100\n\n\n\n\n\n\nDefault\n\n\n25\n\n\n300\n\n\n100\n\n\n\n\n\n\n\n\nSolutions: Application Aware Routing (AAR) is one of the differentiator between SDWAN and traditional WAN technology where you can route traffic based upon Application's SLA. You can classify an application based upon traditional 5 tuples or even applications (Deep Pakcket Inspection). There three action keyword for the seleted application. Prefer; backup and strict. The key to remember is AAR is all about SLA.\n\n\nPrefer means when the preferred color/s meets the SLA, this/these colors will be prefered. If all the preferred colors don't meet the SLA, then depends on if you have backup or strict configure, these two options are mutual exclusive.\n\n\nIf backup color is configured which means when preferred color doesn't meet SLA, first it will use all other colors meeting the SLA regardless if that color is configured as backup or not as long as the color meets the SLA, if there are multiple such colors, it will do load sharing among them. If none of the colors meeting the SLAs, it will use the configured backup color.\n\n\nIf strict is configured (note: stric and backup are mutual exclusive ), the matching traffic will be dropped when the preferred color is not configured.\n\n\nBased upon the requirements, we will do the following, first confgure LTE as last resort which means it won't come up until all other circuits are not available. Then we configure private1 as preferred color, we simply don't need to mention private2 as if private2 meets the SLA, it will be used anyway. If private2 doesn't meet SLA, as neither strict nor backup is configured, it will simply use any available tunnels.\n\n\nStep 1.\n Configure RH LTE interface as last resort circuit as the LTE will only be used when all other circuits becomes unavailable.\n\n\nGo to Configuration->Templates->Feature, search LTE, and select Lab_RH_VPN0_LTE_V01, then click Edit (three dots)\n\n\n\n\nUnder 'Tunnel' section, expand 'Advanced Options', change 'Last-Resort Circuit' settings to Device Specific and click update.Then click three dots, Edit Device Template, check Last-Resort Circuit and Update, Next and Configure Devices. This setting will make LTE last-resort which means the interface will go down, and no traffic go across it until all other circuits become unavailable.\n\n\n\nStep 2.\n Last-Resort verification.\n\n\nSSH to RH and do show ip int brief, you will notice Gig3 is down and Tunnel3 is down as well.\n\n\n\n\nDo show sdwan control connections, there is no control connections on LTE.\n\n\n\n\nDo show sdwan bfd sessions, there is no IPSec tunnel over LTE either.\n\n\n\n\nStep 3.\n Configure SLA classes for app aware routing (AAR)\n\n\nGo to Configurations->Policies->Custome Options->Centralized Policiy->Lists\n\n\n\n\nselect SLA Class and make sure above classes are defined properly.\n\n\n\n\nGo to Centralized Policies->Custom Options->Traffic Policy, then select Application Aware Routing, click Add Policy then Creat New\n\n\n\n\nName: LAB_AAR_V01\nDescription: LAB_AAR_V01\n+Sequence Type->+ Sequence Rule\nMatch-> Destination: 22\nActions-> SLA Class List: Transctional-Data;\n          Preferred Color: private1\n          Counter: transactional-data\nClick Save Match and Actions\n\n\n\n\nClick 'Save Application Aware Routing Policy'\n\n\n\nStep 4.\n Apply the AAR\n\n\nGo to Centralized Policy, Copy the current policy of 'LAB_Central_v01' and change the name and description to 'LAB_Central_v02', then click Copy\n\n\n\n\nEdit the new policy 'LAB_Central_v02', under Traffic Rules->Application Aware Routing, click Add Policy then Import Existing, select LAB_AAR_V01,then Import.\n\n\n\n\nClick Policy Application->Application Aware Routing\n+New Site List and VPN List:\nNew Site List: DCs and RH\nVPN List: VPN1\n\n\nThen click on Add then Save Policy Changes\n\n\n\nActivate the v02 policy by clicking the three dots, then activate.\n\n\n\n\nStep 5.\n Lab Verification\n\n\nGo to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.100.100.100\nClick on Advanced Options:\nProtocol: 6 (TCP)\nDestination Port: 22\nAll Paths: Checked\nClick Simulate\n\n\nYou should see the traffic is only taking the private1 path which means it's using private1 as the preferred transport.\n\n\n\nDo another simultation, this time change the destination port to 23, everything else remain the same.\n\n\nYou should see the traffic will use both private1 and private2 which means it will use all available circuits for all other traffic.\n\n\n\nNow let's shutdown the private1 interface of the RH-WE1, go to Configurations->Templates->Device Template, edit the template of Lab-RH-V01  , then select 'Change Device Values', click the three dots to 'Edit Device Template',check the 'Shutdown(vpn_if_interface)', make sure select the check box under the GigabitEthernet1 section, do not shutdown other interface.Then click Update->Next->Configure Devices.\n\n\n\n\nNow let's verify it again.\n\n\nGo to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.100.100.100\nClick on Advanced Options:\nProtocol: 6 (TCP)\nDestination Port: 22\nAll Paths: Checked\nClick Simulate\n\n\nYou should see the traffic is only taking the private2 path now as private2 is the only one available.\n\n\n\n\nLet's shutdown private2 interface on RH-WE1.go to Configurations->Templates->Device Template, edit the template of Lab-RH-V01  , then select 'Change Device Values', click the three dots to 'Edit Device Template',check the 'Shutdown(vpn_if_interface)', make sure select the check box under the GigabitEthernet2 section, do not shutdown other interface.Then click Update->Next->Configure Devices.\n\n\nNow let's verify it again.\n\n\nGo to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.100.100.100\nClick on Advanced Options:\nProtocol: 6 (TCP)\nDestination Port: 22\nAll Paths: Checked\nClick Simulate\n\n\nYou should see the traffic is taking LTE interface only.\n\n\n\nGreat! You're completed task 5. Before proceed further,let's no shutdown the private1 and private2 interfaces by changing the device vlaue of RH-WE1's device template.\n\n\n\n\n3.5 Lab instructions for task Lab_Task 6 (Application Pinning)\n\n\nACME wants to only run its business critical applications over LTE when all other links go down due to limited available bandwidth on the LTE link. Non-business critical application (such as ICMP) will need to be dropped when LTE comes up.\n\n\nSDWAN Data Policy is a means to pin certain applications on the certain links.\n\n\nStep 1.\n Configure Data Policy.\nGo to Configurations->Policies->Centralized Policy->Custom Options->Traffic Policy->Add Policy\n\n\nName: LAB1_DP_V01\nDescription: LAB1_DP_V01\n+Sequence Type: Custom\n+Sequence Rule\nMatch Conditions:\n    protocol: 6 (TCP)\nActions: Accept\n    Local TLOC (color): private1, private2, LTE\n    save Match and Actions\n\n\n  \n\n\n+Sequence Rule\nMatch Conditions:\n    protocol: 1 (ICMP)\nActions: Accept\n    Local TLOC (color): private1, private2\n    check Restrict (this means traffic will be dropped when configured TLOC unreable)\n    save Match and Actions\n\n\n\n\nChange Default Action to Accept.\nClick Default Action, then click Pencil to edit, click Actions then Accept.\nSave Match and Actions, then click Save Data Policy\n\n\n\n\nStep 2.\n Apply Data Policy.\n\n\nGo to Configuration->Policies->Centralized Policy, select LAB_Central_V02 and Edit.\n\n\nClick Traffic Rules->Traffic Data, Click Add Policy->Import Existing,select LAB1_DP_V01, then Import\n\n\n\n\nClick Policy Application->Traffic Data\n+ New Site List and VPN list\nFrom Service\n    select site list: RH and ALL-Remotes\n    Select VPN list: VPN1\nClick Add then Save Policy Changes, click Activate\n\n\n\n\nStep 3.\n Lab Verification.\n\n\nGo to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.10.101.1 (this is remote site1's VPN1 interface IP)\nClick on Advanced Options:\nProtocol: 1 (ICMP)\nAll Paths: Checked\nClick Simulate\nyou should see traffic is taking private1\n\n\n\n\nChange the Protocol to 6 (TCP) and simulate again\n\n\nYou should not see any changes as private1 is only available circuit.\n\n\n\n\nShutdown private1 and private2 interface on RH-WE1. Go to Configuration->Device Template, Select Lab_RH_V01, edit->change Device Values.\n\n\nInterface GigabitEthernet 1->Shutdown\nInterface GigabitEthernet 2->Shutdown\nUpdate->Next->Configure Devices\n\n\n\n\nsend simulate flows again with ICMP to 10.10.102.1 (remote site 2),\nyou can see the traffic is blockholed.\n\n\n\n\nLet's restore private1 and private2 link by changing the device values of RH-WE1 device template, uncheck the shutdown box of GigabitEthernet1 and 2.Update->Next->Configure Devices\n\n\n\n\nBefore we proceed to the next lab, let's do one more simulation test.\n\n\nGo to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.100.100.100 (this is DC1-WE)\nClick on Advanced Options:\nProtocol: 6 (TCP)\nDestination Port: 22\nAll Paths: Checked\nClick Simulate\nyou should see traffic is taking both private1 & private2.\n\n\nWait a second, our AAR poicy in the previous lab says private1 should be preferred, and we have verified that behavior earlier, why this is taking both private1 and private2 now? This is because our DP says TCP traffic can use all the colors, when you have both AAR and DP configured, DP will take the final decision. You have to be careful with that when designing your AAR and DP and not to have them configured for the same applicaiton on the same sites.\n\n\nBack to Top",
            "title": "Lab 1 Tasks"
        },
        {
            "location": "/lab1/#lab-1-advanced-routing",
            "text": "In this section, you will help ACME on advanced routing using local and central policy. You will perform the following tasks.    ACME DC routers have already tagged all the routes originated from DC1 with BGP community of 65010:1000; all the routes originated from DC2 with BGP community of 65020:2000.  Please configure a route-policy to ensure default route (0.0.0.0/0) coming from DC to set an OMP tag of 100.  For DC1 routes, setting an OMP tag of  1000 ; for DC2 routes, setting an OMP tag of  2000 . (Lab_Task 1)    ACME wants to have a  hub & spoke topology between Remotes and DCs as well between Remotes and Regional hubs . Hub & spoke topology will scale more by reducing NO. of tunnels required on the devices. (Lab_Task 2)    ACME has categorized their branches into multiple Business Units(BUs). In the Data Center (DC) sites, the headend WAN Edges(WEs) are also categorized into multiple BUs for horizontal scaling purpose in terms of throughputs, therefore remote site only needs to build tunnels to its respective DC hub WEs.  Remote Site1 only needs to build tunnels to DC1-WE1 and DC2-WE2 ; on the contrary,  Remote Site 2 only needs to build tunnels to DC1-WE2 and DC2-WE2 .(Lab_Task 2)    Remote sites receive default route from both RH and DC,  DCs will be preferred and load shared . If RH goes down, DCs are load shared for default(Lab_Task 3)    change to  - Remote sites receive default route from both RH and DC,  DCs will be preferred and load shared. RH's default will be used as backup for DCs. (Lab_Task 3)**    Remotes sites receive more specific routes from both DCs,  routes originated from local DC are preferred , if one DC goes down, it will use the routes from another DC as backup. In another words, from remote sites perspective, previously routes tagged with 1000 will prefer DC1; routes tagged with 2000 will prefer DC2.(Lab_Task 4)    For remote sites to any other regional routes are forced to go through DC\u2019s functional hub. For  remote site1, it goes through WE1 in DC1 and DC2 ; for  remote site 2, it goes through WE2 in DC1 and DC2 .(Lab_Task 4)    Note: In these lab exercises, it's possible that there are multiple ways to achieve the requirements. The lab guide provides a detailed step by step instruction for each taks. However you're welcomed to solve it with your own solution. Just be mindful with the time.",
            "title": "Lab 1: Advanced Routing"
        },
        {
            "location": "/lab1/#task-1-local-route-policy",
            "text": "",
            "title": "Task 1: Local Route Policy"
        },
        {
            "location": "/lab1/#step-11-verification-of-the-routes-received-on-dc-wes",
            "text": "SSH to  DC1-WE1  (repeat the same on DC1-WE2,DC2-WE1,DC2-WE2,R1-WE1 and R2-WE2 as well) and do  show ip route vrf 1  and make sure  10.100.100.0/24, 10.200.200/24  as well as  0.0.0.0/0  learned via BGP.",
            "title": "Step 1.1 Verification of the routes received on DC WEs."
        },
        {
            "location": "/lab1/#step-12-verify-the-bgp-communities",
            "text": "10.100.100.0/24 should tag with 65010:1000; 10.200.200.0/24 should tag with 65020:2000. Execute  show ip bgp vpnv4 vrf 1 <prefix>  (10.100.100.0/24 and 10.200.200.0/24) on DC1-WE1,WE2 and DC2-WE1,WE2.",
            "title": "Step 1.2 Verify the BGP communities."
        },
        {
            "location": "/lab1/#step-13-set-omp-tag-for-dc-specific-routes",
            "text": "login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies  Click  Custom Options  drop down on the top right and select  Route Policy  under  Localized Policy  Click  Add Route Policy  to Create new  Name:  LAB_DCs_BGP_RP   (write down this name, it will be used later)  Description:  LAB_DCs_BGP_RP   Click  +Sequence Type  on the left then click  +Sequence Rule , click Match, select Address, select  default .      Click  Action , change to  Accept , then select OMP tag, key in  100 , then save Match and Actions.    click  Sequence Rule  to create following two rules:   Match  community-list DC1_Routes ,  Accept  and Set  Tag 1000  Match  community-list DC2_Routes ,  Accept  and Set  Tag 2000     Then click on Save Route Policy",
            "title": "Step 1.3 set OMP tag for DC specific Routes"
        },
        {
            "location": "/lab1/#step-14-creating-a-local-policy",
            "text": "login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies  Click on  Localized Policy , then click on  Add Policy     Click on Next to proceed till you see  Configure Route Policy ; click  Add Route Policy  then select  Import Existing Policy ; Select  LAB_DCs_BGP_RP  click import     Click on Next, Key in  Policy Name:  LAB_DCs_Local_policy  Policy Description:  LAB_DCs_Local_policy  .  Check  Netflow, Application  and  Implicit ACL Logging .  Then click on Save Policy (Feel free to click Preview before save)",
            "title": "Step 1.4 Creating a Local Policy"
        },
        {
            "location": "/lab1/#step-15-apply-the-route-policy",
            "text": "Access feature template configuration from  Configuration - Templates - Feature  Locate feture template  Lab_DC_VPN1_BGP_V01  and select three dots then click  Edit .     Select  Neighbor  section, then click on the pencil icon under Action.      Update the following:    Address Family  changes to Global and set to  On   Address Family  changes to Global and set to  ipv4-unicast  Route Policy In  changes to Global and set to  On  Policy Name  changes to Global and set to  LAB_DCs_BGP_RP \n(this was the name you wrote down earlier)  then click on Save changes and Click on Update     Then click Next, feel free to review the config changes, then click Configure Devices, then check the Confim configuration box and click on OK.",
            "title": "Step 1.5 apply the route-policy"
        },
        {
            "location": "/lab1/#step-16-verify-omp-tags",
            "text": "SSH to DC wEdge routers( DC1-WE1,DC1-WE2,DC2-WE1,DC2-WE2 ) and run  show ip bgp vpnv4 vrf 1 <prefix>  (10.100.100.0/24,10.200.200.0/24), you should see proper OMP tags are set",
            "title": "Step 1.6 Verify OMP Tags"
        },
        {
            "location": "/lab1/#task-2-hub-spoke-topologies",
            "text": "",
            "title": "Task 2: Hub &amp; Spoke Topologies"
        },
        {
            "location": "/lab1/#step-21-pre-config-verifications",
            "text": "SSH to  R1-WE1  and do  show sdwan omp route vpn 1    Question: Do you know why the default route learned from private2 shown as invalid and unreachable (Inv,U) ?   This is because R1-WE1 doesn't have a transport with private 2 color. If you watch the route on R2-WE1, you should notice the next hop from private 1 marked as  (Inv,U)  for the same reason where private 1 color doesn't exist on R2-WE1.  Question: Did you notice the default route is learned from 1.1.30.2 which is the Regional Hub(RH)? Do you know why?    To answer this question, we will check the route table at vSmart as all the routes are advertised by vSmart. SSH to vSmart and do  show omp route vpn 1 0.0.0.0/0 detail | t   OMP is very much like BGP when it comes down to route preference. In the order of preference, there is a origin-protocol, in this case the default route learned on RH is from Static (by design, in real deployment, probably it's going to be BGP as well); whereas the default learned from DCs is from iBGP. Origin protocol static is more preferred than iBGP.  Now, let's look at the specific routes learned from DC. Do  show sdwan omp route vpn 1 10.100.100.0/24  on vSmart.   Question: you will see 4 paths and one of the paths shows Inv,U. Hopefully you can answer why it's that. But why there are 4 paths?  Let's SSH to vSmart and do  show omp route vpn 1 10.100.100.0/24 | t .   You will see 12 ECMP routes marked as  C,R  (Chosen,Resolved). Why 12? Because we have 4 DC wEdges each with 3 transports, so total 12 paths.   The next question will be why there are only 4 paths on the remote wEdges? This is because the ECMP settings on the wEdge by default is set to 4. If you change it to 16 (currently 16, it will be increased to 128 in the future release), you will see all 12 paths.   Note: vSmart randomly selects 4 paths (or whatever the max ECMP value is set) and install on the device. In a  large deployment where multiple paths is more than 16 (before 128 paths is supported), this may pose problem.  In this exercise we purposely keep the default ECMP setting and learn how to solve this issue with centralized policy.",
            "title": "Step 2.1. Pre-config verifications"
        },
        {
            "location": "/lab1/#step-22-create-a-topology-for-centralized-policy",
            "text": "login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies    Click  Custom Options  drop down on the top right and select  Topology  under  Centralized Policy    Click  Add Topology  under  Topology  and select  Custom Control(Route&TLOC)     You are going to create two topologies, one for each remote site.   Create topology policy for Remote1  Name:  LAB_Topo_RS1  Description:  LAB topology for Remote Site 1  Click  +Sequence Type  and select  Route  Click  +Sequence Rule , leave unchanged under Match(means match all)  Click  Actions  and change to  Accept  (we'll come back and do the routes policy later).  click  +Sequence Type  then select  TLOC  click  +Sequence Rule , select  TLOC .  Under  Match Conditions , selects  DCs-BU1-TLOCs  for  TLOC List  (this TLOC list has been pre-defined for you which includes all the TLOCs of DC1-WE1 and DC2-WE1  Click  Actions , change Actions to  Accept  Click  +Sequence Rule , select  TLOC  under  Match Conditions , selects  RH  for  TLOC List  (this TLOC list has been pre-defined for you which includes all the TLOCs of RH)   Click  Actions , change Actions to  Accept    Then click save Control Policy.    This policy effectively allows R1-WE1 to build tunnels to all the DCs-BU1 devices (DC1-WE1 and DC2-WE1) as well as RH, nothing else as the default action is reject.    Follow the above steps and create another topology for Remote2 with the following settings:  Name:  LAB_Topo_RS2  Description:  LAB topology for Remote Site 2  Click  +Sequence Type  then select  Route  Click  +Sequence Rule , leave unchanged under Match(means match all),  Click  Actions  change Actions to  Accept  (we'll come back and do the routes policy later).  Click  +Sequence Type  then select  TLOC  click  +Sequence Rule , select  TLOC .  Under  Match Conditions , selects  DCs-BU2-TLOCss  for  TLOC List  (this TLOC list has been pre-defined for you which includes all the TLOCs of DC1-WE2 and DC2-WE2)  Click  Actions , change Actions to  Accept  Click  +Sequence Rule , select  TLOC  under  Match Conditions , selects  RH  for  TLOC List  (this TLOC list has been pre-defined for you which includes all the TLOCs of RH)  Click  Actions , change Actions to  Accept  Then click save Control Policy.   This policy effectively allows R2-WE1 to build tunnels to all the DCs-BU1 devices (DC1-WE2 and DC2-WE2) as well as RH, nothing else as the default action is reject.",
            "title": "Step 2.2. Create a topology for centralized policy"
        },
        {
            "location": "/lab1/#step-23-apply-the-topology-policy-to-centralized-policy",
            "text": "login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies  Click  Add Policy  under  Centralized Policy  Click next, you will see Configure Topology and VPN membership - Click  Add topology , select  Import Existing Topology  Click  Custom Control(Route and TLOC) , select  LAB_Topo_RS1  Click on Add Topology  follow the above steps to add topology  LAB_Topo_RS2  as well      Click Next and Next, you will see Apply Policies to Sites and VPNs,   Policy Name: LAB_Central_v01\nDescription: Task2 Topo only\nClick New Site List Under LAB_Topo_RS1, under Outbound Site List, select RS1,then click on Add\nClick New Site List Under LAB_Topo_RS2, under Outbound Site List, select RS2,then click on Add\nthen click Save Policy   Step 4.  Activate the first Centralized Policy  Go to Configuration Centralized Policy, click ...(three dots) of our LAB_Centeral_v01, then click on Activate, and Activate. Policy will be pushed to the vSmart.   Step 5.  Verify the hub & spoke topology where R1-WE1 and R2-WE1 should not have tunnel between them but everyone else.  SSH to R1-WE1 & R2-WE1 do show sdwan bfd sessions, you can see no bfd session between R1-WE1 and R2-WE1",
            "title": "Step 2.3. Apply the topology policy to Centralized Policy"
        },
        {
            "location": "/lab1/#33-lab-instructions-for-task-lab_task-3-default-route-handling",
            "text": "Step 1.  Default Route Handling. The requirement is to prefer the default route learned from DC over RH. We need to modify our Centralized policy so that the default from DC has higher OMP perference over RH. First, let's make a new version of the topology policy, that way, when you update your policy in a production network you can also fall back to the previous version.  Go to Configurations->Policies->Centralized Policy, click three dots of LAB_Topo_RS1 and then click Copy.   Name: LAB_Topo_RS1_V02  Description: +Default Route handling   Step 2.  Let's edit the new topology. click Edit under three dots of LAB_Topo_RS1_V02.We're going to add two new rules, rule1: match default & originator of 1.1.10.1(DC1-WE1) then accept and set preference of 100; rule2: match default & originator of 1.1.20.1(DC2-WE1) then accept and set preference of 100; and we need to make sure the sequence of these two new rules are ahead of previous accept all rule as the order on vSmart policy does matter, it will do the lookup based upon the order, if it finds the match, it will use that rule and it won't look for subsequent rule any more. Then click Save policy.   Step 3.  Let's apply the policy and verify.  Go to Configuration->Policies->Centralized Policy, edit(three dots) the current policy(In production deployment, you always want to use the same practice of copying the current policy then apply it. Just demonstrate how to update the current policy works.)  Select Topology, edit LAB_Topo_RS1 then click Detach which will remove this topology.   Add the new topology we're just created. Click Add Topology,select Import Existing Topology then select LAB_Topo_RS1_V02, then click Import.   Click on Policy Application->New Site List->Outbound Site List, select RS1,then click on ADD, Save Policy Changes, then Activate.\nNote: Outbound and Inbound are from vSmart perspective where outbound policy means how the routes are sent out from vSmart; inbound policy means how the routes are sent to the vSmart.   Step 4.  Once the policy is activated, let's do some verifications.\nSSH to R1-WE1 and do show sdwan omp route and see the learned TLOC for default  route as well as preference. We're expecting the routes are learned from DC1-WE1 and DC2-WE1 with preference of 100. Oh, no the routes are not changed at all, the three installed routes still learned from RH and no preference set either.Why is that?   Let's check omp route table on the vSmart, SSH to vSmart and do show omp route | t. As you recall, the OMP routes don't have any changes either where 3 paths learned from RH marked with C,R due to routes originated from Static which are preferred over originated from iBGP. But why the outbound policy setting the routes originated from DC1-WE1 and DC2-WE1 doesn't work, this is because outbound policy will only look for the chosen routes with C.R by default, other routes without learned from DCs as they are not chosen without C,R, so those routes are not even going through the outbound policies. There are multiple way of changing this behavior such as using inbound policy or configure send-backup path, or make every route with C.R. We're not going over all the solutions. Let's configure an vSmart inbound policy to make the default routes from DCs have higher OMP preference than RH's. Note: vSmart inbound policy may not be an ideal solution for the senarios. It is recommended to use outbound policy only if an outbound policy can meet the requirements without additional inbound policy for its simplicity and full visibility of vSmart.   Step 5.  Let's configure an inbound policy by creating a new topology first, go to Configuration->Policies-> Custom Options->Centralized Policy->Topology, then Add Topology->Custom Control with the following settings:  Name: default_route_from_DC\nDescription: default_route_from_DC\n+Sequence Type: Route\n+Sequence Rule\nMatch->Prefix List: default\nSite List: DCs\nActions->Accept preference:50\nDefault Action: Accept  Then Save Control Policy   Apply this new topology to the current policy.  Go to Configuration->Policies->Centralized Policy, Edit(three Dots)the LAB_Central_v01, Click Add Topology,select Import Existing Topology then select default_route_from_DC, then click Import.   Click on Policy Application->New Site List->Iutbound Site List, select DCs,then click on ADD, Save Policy Changes, then Activate.\nNote:This time is an inbound policy wehre inbound policy controls how the vSmart are seeing the routes.   Step 6.  SSH to vSmart and do show omp route vpn 1 | t, we can see the routes from DCs are C,R with preference 50 now which is expected.   SSH to R1-WE1 and do show sdwan omp route vpn 1 , we can see 4 paths from DCs with preference 100. Remember the vSmart outbound policy we assign preference of 100 where the inbound policy we assign preference of 50 so that we can differentiate which policy is taking effect.   Well done! You have finished the default route handling task for R1-WE1.Let's do the same policy for R2-WE1.  Step 1.  Go to Configurations->Policies->Centralized Policy, click three dots of LAB_Topo_RS1v02 and change Name and Description to LAB_Topo_RS2v02 then click Copy.   Step 2.  Modify the topology for R2-WE2.\nselect TLOC as the Sequence Type, edit Rule1, we need to change the TLOC List from BU1 to BU2 as we'd like to use the BU2's functional hub which are DC1-WE2 and DC2-WE2 as the entry point for remote site 2(Remember remote site 2 represents the remote sites for BU2, where remote site 1 represents the remote sites for BU1). Remove the DCs-BU1-TLOCs by clicking the x, then select DCs-BU2-TLOCs instead, then click Save Match and Actions.   Select Route as the Sequence Type, we need to change the originator from 1.1.10.1 and 1.1.20.2 to 1.1.10.2 and 1.1.20.2 respectively . By doing this, default route from DC1-WE2 and DC2-WE2 will have OMP preference of 100 sent to R2-WE2 site.   Step 3.  Apply this topology to the Centralized Policy.\nGo to Configurations->Policies->Centralized Policy, Edit LAB_Central_v01.   Go to Topology->Add Topology->Import Existing Topology->Custom Control, then select LAB_Topo_RS2_V02, Import.   Remove the previous RS2 topology by selecting the topology of LAB_Topo_RS2, click detach.   Click Policy Application->Select New Site List under LAB_Topo_RS2_V02, select RS2 as outbound site list, click Add, then save Policy Change, click Activate.   Once the policy has been pushed to vSmart, let's verify by SSH to R2-WE1 and do show ip route vrf 1. Now, default route has two ECMP paths, one path for each DC.  \nLet's do show sdwan omp route vpn 1.You will see that there are 4 paths in the OMP route table, however none of them are valid",
            "title": "3.3 Lab instructions for task Lab_Task 3 (Default Route handling)"
        },
        {
            "location": "/lab1/#34-lab-instructions-for-task-lab_task-4-specific-routes-handling",
            "text": "Step 1.  Now, we're going to control the more specific routes, the goal is to prefer the more specific routes originated from its DC on the remote sites. In the meanwhile, for BU1 (R1-WE1), it only needs to learn the routes from BU1's Headend devices (DC1-WE1, DC2-WE1); for BU2(R2-WE1), it only needs to learn the routes from BU2's Headend devices.\nRemember the specific routes from DC1 already tagged with 1000, from DC2 already tagged with 2000. The idea is to create different policies for BU1 and BU2 sites such that give different OMP preference for different OMP tag.  Go to Configuration->Policies->Custom Options->Centralized Policy-> Topology. Let's edit the current topologies (LAB_Topo_RS1_V02 and LAB_Topo_RS2_V02). click Edit under three dots of LAB_Topo_RS1_V02.Select Route as the sequence type,we're going to add four more rules, match OMP Tag 1000 and TLOC of DC1-BU1-TLOCs accept and set preference of 100 ; match OMP Tag 1000 and TLOC of DC2-BU1-TLOCs accept and set preference of 50;  match OMP Tag 2000 and TLOC of DC2-BU1-TLOCs accept and set preference of 100 ; match OMP Tag 2000 and TLOC of DC1-BU1-TLOCs accept and set preference of 50;and we need to make sure the sequence of these rules are ahead of previous accept all rule as the order on vSmart policy does matter, it will do the lookup based upon the order, if it finds the match, it will use that rule and it won't look for subsequent rule any more. Dragging the new rule up and drop the rule in front of the accept all rule (if you follow the lab previously, the new rules should be No. 5, 6,7 and 8, match all rule should be rule No. 9), Then click Save policy and Activate. This will make the vSmart to push the policy immediately after you confirm configuring devices (this is expected as illuted earlier, creating a new policy is a best practice otherwise upating the existing policy will cause the immediate policy push. )   Let's verify. SSH to R1-WE1 and do show sdwan omp route vpn 1, you can see 4 paths for 10.100.100.0/24, however we see 3 paths with preference of 100, 1 path doesn't have preference; and for 10.200.200.0/24, there are 4 paths however 3 paths with preference of 50, 1 path doesn't have preference. If you look at it closely you will notice that the paths picked are from the lowest system-ip.   This is caused that vSmart by default will only send 4 paths to the wEdges. When vSmart is going through the outbound policy, it takes a route from vsmart route table in the winning order (marked as C,R) and compare it with the outbound policy as long as there is a match (permit) in the policy for a particular prefix, it will send it out and count it as one until it hits the send-path-limits which is 4 by default. Since in our route-policy, we have a permit all at the end which means every route will have a match, therefore first 4 routes in the winning order are sent out regardless which rule they're matching in the policy. There are multiple ways to fix this, the simple way is to change the limit to 16 on both vSmart as well as on the wEdges.  Step 2.  Configure send-path-limit 16 on vSmart  Go to Configuration->Templates->Device Template, edit vSmart template, under the OMP config section, add one new command 'send-path-limit 16', then click Update, then Configure Devices.   Step 3.  Change ecmp-limit to 16 on the wEdges.  Go to Configuration->Templates->Feature Template (tab, next to Device Tempalte), search for OMP, and edit Lab_OMP_V01, Under Basic Configuration section look for ECMP limit, change it to Global, and set to 16.Then update, Next, Configure Devices.check Confirm configuration changes on 7 Devices, then  OK.   Step 4.  Verification.\nSSH to R1-WE1 and do show sdwan omp route vpn 1, you should see each route (10.100.100.0/24 and 10.200.200.0/24) will have 12 paths and 3 paths from prefered DC with preference of 100, 3 paths from secondary DC with preference of 50, another 6 paths from are invalid from other BU hub devices.   do show ip route vrf 1; you will see 10.100.100.0/0 is leared from 1.1.10.1; 10.200.200.0/24 is learned from 1.1.20.1 whis is desired.   Next, we need to do the same for LAB_Topo_RS2. Step 5.  Go to Configuration->Policies->Custom Options->Centralized Policy-> Topology. Click Edit under three dots of LAB_Topo_RS1_V02.Select Route as the sequence type,we're going to add four more rules, match OMP Tag 1000 and TLOC of DC1-BU2-TLOCs accept and set preference of 100 ; match OMP Tag 1000 and TLOC of DC2-BU2-TLOCs accept and set preference of 50;  match OMP Tag 2000 and TLOC of DC2-BU2-TLOCs accept and set preference of 100 ; match OMP Tag 2000 and TLOC of DC1-BU2-TLOCs accept and set preference of 50;and we need to make sure the sequence of these rules are ahead of previous accept all rule as the order on vSmart policy does matter, it will do the lookup based upon the order, if it finds the match, it will use that rule and it won't look for subsequent rule any more. Dragging the new rule up and drop the rule in front of the accept all rule (if you follow the lab previously, the new rules should be No. 5, 6,7 and 8, match all rule should be rule No. 9), Then click Save policy and Activate. This will make the vSmart to push the policy immediately after you confirm configuring devices (this is expected as illuted earlier, creating a new policy is a best practice otherwise upating the existing policy will cause the immediate policy push. )   Step 6.  Verification.\nSSH to R2-WE1 and do show sdwan omp route vpn 1, you should see each route (10.100.100.0/24 and 10.200.200.0/24) will have 12 paths and 3 paths from prefered DC with preference of 100, 3 paths from secondary DC with preference of 50, another 6 paths from are invalid from other BU hub devices.   do show ip route vrf 1; you will see 10.100.100.0/0 is leared from 1.1.10.2; 10.200.200.0/24 is learned from 1.1.20.2 whis is desired.   This concludes the routing handling for the specific routes.",
            "title": "3.4 Lab instructions for task Lab_Task 4 (Specific Routes handling)"
        },
        {
            "location": "/lab1/#35-lab-instructions-for-task-lab_task-5-application-aware-routing",
            "text": "ACME wants to provide best user experience for their transactional data ( we will use SSH to simulate that) which has to meet the below SLA requirement. In the mean while, ACME would like to use private 1 as the preferred link, if private 1 doesn't meet the SLA requirement, it will use private 2 when private 2 still meets the SLA. LTE link will only be used when both private 1 and private 2 go down. ACME has the following SLA requirements for their applications.     Application  Loss(%)  Lattency(msec)  Jitter(msec)      Transactional Data  5  50  100    Bulk-Data  10  300  100    Voice-and-Video  2  45  100    Default  25  300  100     Solutions: Application Aware Routing (AAR) is one of the differentiator between SDWAN and traditional WAN technology where you can route traffic based upon Application's SLA. You can classify an application based upon traditional 5 tuples or even applications (Deep Pakcket Inspection). There three action keyword for the seleted application. Prefer; backup and strict. The key to remember is AAR is all about SLA.  Prefer means when the preferred color/s meets the SLA, this/these colors will be prefered. If all the preferred colors don't meet the SLA, then depends on if you have backup or strict configure, these two options are mutual exclusive.  If backup color is configured which means when preferred color doesn't meet SLA, first it will use all other colors meeting the SLA regardless if that color is configured as backup or not as long as the color meets the SLA, if there are multiple such colors, it will do load sharing among them. If none of the colors meeting the SLAs, it will use the configured backup color.  If strict is configured (note: stric and backup are mutual exclusive ), the matching traffic will be dropped when the preferred color is not configured.  Based upon the requirements, we will do the following, first confgure LTE as last resort which means it won't come up until all other circuits are not available. Then we configure private1 as preferred color, we simply don't need to mention private2 as if private2 meets the SLA, it will be used anyway. If private2 doesn't meet SLA, as neither strict nor backup is configured, it will simply use any available tunnels.  Step 1.  Configure RH LTE interface as last resort circuit as the LTE will only be used when all other circuits becomes unavailable.  Go to Configuration->Templates->Feature, search LTE, and select Lab_RH_VPN0_LTE_V01, then click Edit (three dots)   Under 'Tunnel' section, expand 'Advanced Options', change 'Last-Resort Circuit' settings to Device Specific and click update.Then click three dots, Edit Device Template, check Last-Resort Circuit and Update, Next and Configure Devices. This setting will make LTE last-resort which means the interface will go down, and no traffic go across it until all other circuits become unavailable.  Step 2.  Last-Resort verification.  SSH to RH and do show ip int brief, you will notice Gig3 is down and Tunnel3 is down as well.   Do show sdwan control connections, there is no control connections on LTE.   Do show sdwan bfd sessions, there is no IPSec tunnel over LTE either.   Step 3.  Configure SLA classes for app aware routing (AAR)  Go to Configurations->Policies->Custome Options->Centralized Policiy->Lists   select SLA Class and make sure above classes are defined properly.   Go to Centralized Policies->Custom Options->Traffic Policy, then select Application Aware Routing, click Add Policy then Creat New   Name: LAB_AAR_V01\nDescription: LAB_AAR_V01\n+Sequence Type->+ Sequence Rule\nMatch-> Destination: 22\nActions-> SLA Class List: Transctional-Data;\n          Preferred Color: private1\n          Counter: transactional-data\nClick Save Match and Actions   Click 'Save Application Aware Routing Policy'  Step 4.  Apply the AAR  Go to Centralized Policy, Copy the current policy of 'LAB_Central_v01' and change the name and description to 'LAB_Central_v02', then click Copy   Edit the new policy 'LAB_Central_v02', under Traffic Rules->Application Aware Routing, click Add Policy then Import Existing, select LAB_AAR_V01,then Import.   Click Policy Application->Application Aware Routing\n+New Site List and VPN List:\nNew Site List: DCs and RH\nVPN List: VPN1  Then click on Add then Save Policy Changes  Activate the v02 policy by clicking the three dots, then activate.   Step 5.  Lab Verification  Go to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.100.100.100\nClick on Advanced Options:\nProtocol: 6 (TCP)\nDestination Port: 22\nAll Paths: Checked\nClick Simulate  You should see the traffic is only taking the private1 path which means it's using private1 as the preferred transport.  Do another simultation, this time change the destination port to 23, everything else remain the same.  You should see the traffic will use both private1 and private2 which means it will use all available circuits for all other traffic.  Now let's shutdown the private1 interface of the RH-WE1, go to Configurations->Templates->Device Template, edit the template of Lab-RH-V01  , then select 'Change Device Values', click the three dots to 'Edit Device Template',check the 'Shutdown(vpn_if_interface)', make sure select the check box under the GigabitEthernet1 section, do not shutdown other interface.Then click Update->Next->Configure Devices.   Now let's verify it again.  Go to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.100.100.100\nClick on Advanced Options:\nProtocol: 6 (TCP)\nDestination Port: 22\nAll Paths: Checked\nClick Simulate  You should see the traffic is only taking the private2 path now as private2 is the only one available.   Let's shutdown private2 interface on RH-WE1.go to Configurations->Templates->Device Template, edit the template of Lab-RH-V01  , then select 'Change Device Values', click the three dots to 'Edit Device Template',check the 'Shutdown(vpn_if_interface)', make sure select the check box under the GigabitEthernet2 section, do not shutdown other interface.Then click Update->Next->Configure Devices.  Now let's verify it again.  Go to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.100.100.100\nClick on Advanced Options:\nProtocol: 6 (TCP)\nDestination Port: 22\nAll Paths: Checked\nClick Simulate  You should see the traffic is taking LTE interface only.  Great! You're completed task 5. Before proceed further,let's no shutdown the private1 and private2 interfaces by changing the device vlaue of RH-WE1's device template.",
            "title": "3.5 Lab instructions for task Lab_Task 5 (Application Aware Routing)"
        },
        {
            "location": "/lab1/#35-lab-instructions-for-task-lab_task-6-application-pinning",
            "text": "ACME wants to only run its business critical applications over LTE when all other links go down due to limited available bandwidth on the LTE link. Non-business critical application (such as ICMP) will need to be dropped when LTE comes up.  SDWAN Data Policy is a means to pin certain applications on the certain links.  Step 1.  Configure Data Policy.\nGo to Configurations->Policies->Centralized Policy->Custom Options->Traffic Policy->Add Policy  Name: LAB1_DP_V01\nDescription: LAB1_DP_V01\n+Sequence Type: Custom\n+Sequence Rule\nMatch Conditions:\n    protocol: 6 (TCP)\nActions: Accept\n    Local TLOC (color): private1, private2, LTE\n    save Match and Actions      +Sequence Rule\nMatch Conditions:\n    protocol: 1 (ICMP)\nActions: Accept\n    Local TLOC (color): private1, private2\n    check Restrict (this means traffic will be dropped when configured TLOC unreable)\n    save Match and Actions   Change Default Action to Accept.\nClick Default Action, then click Pencil to edit, click Actions then Accept.\nSave Match and Actions, then click Save Data Policy   Step 2.  Apply Data Policy.  Go to Configuration->Policies->Centralized Policy, select LAB_Central_V02 and Edit.  Click Traffic Rules->Traffic Data, Click Add Policy->Import Existing,select LAB1_DP_V01, then Import   Click Policy Application->Traffic Data\n+ New Site List and VPN list\nFrom Service\n    select site list: RH and ALL-Remotes\n    Select VPN list: VPN1\nClick Add then Save Policy Changes, click Activate   Step 3.  Lab Verification.  Go to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.10.101.1 (this is remote site1's VPN1 interface IP)\nClick on Advanced Options:\nProtocol: 1 (ICMP)\nAll Paths: Checked\nClick Simulate\nyou should see traffic is taking private1   Change the Protocol to 6 (TCP) and simulate again  You should not see any changes as private1 is only available circuit.   Shutdown private1 and private2 interface on RH-WE1. Go to Configuration->Device Template, Select Lab_RH_V01, edit->change Device Values.  Interface GigabitEthernet 1->Shutdown\nInterface GigabitEthernet 2->Shutdown\nUpdate->Next->Configure Devices   send simulate flows again with ICMP to 10.10.102.1 (remote site 2),\nyou can see the traffic is blockholed.   Let's restore private1 and private2 link by changing the device values of RH-WE1 device template, uncheck the shutdown box of GigabitEthernet1 and 2.Update->Next->Configure Devices   Before we proceed to the next lab, let's do one more simulation test.  Go to Monitor, then select RH-WE1, then select Troubleshooting->Simulate Flows\nVPN:VPN-1\nSource/Interface for VPN-1:Gigabiethernet4\nSource IP: 10.10.30.2\nDestination IP: 10.100.100.100 (this is DC1-WE)\nClick on Advanced Options:\nProtocol: 6 (TCP)\nDestination Port: 22\nAll Paths: Checked\nClick Simulate\nyou should see traffic is taking both private1 & private2.  Wait a second, our AAR poicy in the previous lab says private1 should be preferred, and we have verified that behavior earlier, why this is taking both private1 and private2 now? This is because our DP says TCP traffic can use all the colors, when you have both AAR and DP configured, DP will take the final decision. You have to be careful with that when designing your AAR and DP and not to have them configured for the same applicaiton on the same sites.  Back to Top",
            "title": "3.5 Lab instructions for task Lab_Task 6 (Application Pinning)"
        },
        {
            "location": "/lab2/",
            "text": "Lab 2: Route to the legacy site\n\n\n\n\nIn this section, you will help ACME to configure routing between sd-wan remote sites and legacy none sd-wan site. The legacy site is connected to SP \npriviate1\n with OSPF as CE-PE protocol. Legacy site prefix \n10.11.1.0/24\n is advertised to \nprivate1\n PE router; DC WAN Edge routers are receiving this prefix from service side over BGP.\n\n\n\n\nTo make sure traffic between sd-wan remotes and legacy site use optimal path, ACME requires\n- SD-WAN site Remote2 uses DC as transit site to reach legacy site over private2.\n-  SD-WAN site Remote1 route directly over private 1 to legacy site.\n\n\n\n\nStep1: Verify current route\n\n\n\n\n\n\nSSH into ubuntu host in Remote1 and Remote2.\n|R1-VM1|198.18.133.200:19018|\n|---|---|\n|\nR1-WM1\n|\n198.18.133.200:19019\n|\n\n\n\n\n\n\nrun \ntraceroute 10.11.1.1\n from both hosts as show in below sreenshots\n\n\n\n\n\n\n\n\n\n\nAs show from the traceroute, ubuntu host from both remote sites are using DC1 as transit site to reach prefix \n10.11.1.0/24\n from legacy site.\n\n\nStep2: Route policy for Remote2\n\n\nThe requirement for remote2 is to use DC as transit site and use transport \nprivate2\n. To achieve that, you can modify the central policy created in \nlab1\n to set higher OMP preference for prefix \n10.11.1.0/24\n from color \nprivate2\n.\n- login vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies\n\n- Click \nCustom Options\n on the upper right corner and select \nLists\n under \nCentralized Policy\n as show below.\n\n\n\n- select \nPrefix\n and click \nNew Prefix List\n to add prefix \n10.11.1.0/24\n for legacy site as show below. Click \nAdd\n to save new prefix list \nLegacy_prefix\n .\n \n\n\n\n\nClick \nCustom Options\n on the upper right corner and select \nTopology\n under \nCentralized Policy\n.\n\n\nSelect Topology policy \nLAB_Topo_RS2\n created in lab1, and click the \n\"...\"\n to Edit.\n\n\nSelect \nRoute\n under \nSequence Type\n from the left.\n \n\n\nClick \nSequence Rule\n to add new rule. For omp route that matches \nLegacy_prefix\n and \nprivate2\n color, set \nPreference\n 200.\n \n\n ##### \n \nNote\n: After save, move the new created rule to the top by drag and drop the sequence number left to the rule. \n\n\nRun \ntraceroute 10.11.1.1\n again from Remote2 host and compare the path from previous output.\n \n\n\n\n\n#### Step3: Route policy for Remote1\n\n\nThe requirement for remote1 is to use \nprivate1\n route directly to legacy site. To achieve that, you can leak prefix \n10.11.1.0/24\n from VPN0 into service VPN.\n\n\nSP \nprivate1\n uses OSPF as PE-CE routing protocol; create OSPF feature template and attach to R1-WE1 VPN0.\n- login vManage \n198.18.133.200\n and access feature template from \nConfiguration - Template\n then click \nFeature\n\n- Click \nAdd Template\n and select OSPF template as show below.\n \n\n - Name the template: \nLab_OSPF_VPN0_V01\n\n - Assign Router ID: \n1.1.100.1\n\n \n\n - Add \nconnected\n as protocol under \nREDISTRIBUTE\n section\n \n\n - enable OSPF Area 0 on interface GigabitEthernet1\n \n\n- Access device template from \nConfiguration - Template\n then locate template \nLab_R1_V01\n. Click \n\"...\"\n for more option and select Edit.\n - Move to \nTransport & Management VPN\n section, Add \nCisco OSPF\n template and select \nLab_OSPF_VPN0_V01\n from dropdown list.\n \n \n\n- Update the device template and trigger vManage to update R1-VE1 configuration.\n- After vManage complete the push, SSH into \nR1-WE1\n to verify new OSPF neighbor and routes learned OSPF routes.\n \n\n \n\nConfigure route leaking between VPN0 and service VPN, so R1-WE1 will use the OSPF route learned from OSPF in VPN0 for prefix \n10.11.1.0/24\n\n- login vManage \n198.18.133.200\n and access feature template from \nConfiguration - Template\n then click \nFeature\n\n- Locate existing template \n\"Lab_Remote_VPN1_V01\"\n. Click \n\"...\"\n for more option and select Edit.\n - Move to \nGlobal Route Leak\n section. Add OSPF under \nAdd New Route Leak from Global VPN to Service VPN\n \n\n - Add connected under \nAdd New Route Leak from Service VPN to Global VPN\n \n\n \n \n\n - Update the template to trigger configuration push from vManage to R1-WE1\n\n\nNote: As optional task, you can add route policy to limit the routes being leaked between Global and service VPN\n\n- SSH into R1-WE1 to verify route \n10.10.101.0/24\nbeing added in global route table\n \n\n- SSH into R1-WE1 to verify route \n10.11.1.0/24\n being added in VRF 1 route table. The SP prefixes \n172.1.x.0\n are also leaked into service VPN which can be limited from additional route policy in previous step.\n \n\n- Now let's verify the new route path from remote1 Ubuntu host. Run \ntraceroute 10.11.1.1\n again from Remote1 host and compare the result from previous output.\n \n  \n\n\nBack to Top",
            "title": "Lab 2 Tasks"
        },
        {
            "location": "/lab2/#lab-2-route-to-the-legacy-site",
            "text": "In this section, you will help ACME to configure routing between sd-wan remote sites and legacy none sd-wan site. The legacy site is connected to SP  priviate1  with OSPF as CE-PE protocol. Legacy site prefix  10.11.1.0/24  is advertised to  private1  PE router; DC WAN Edge routers are receiving this prefix from service side over BGP.   To make sure traffic between sd-wan remotes and legacy site use optimal path, ACME requires\n- SD-WAN site Remote2 uses DC as transit site to reach legacy site over private2.\n-  SD-WAN site Remote1 route directly over private 1 to legacy site.",
            "title": "Lab 2: Route to the legacy site"
        },
        {
            "location": "/lab2/#step1-verify-current-route",
            "text": "SSH into ubuntu host in Remote1 and Remote2.\n|R1-VM1|198.18.133.200:19018|\n|---|---|\n| R1-WM1 | 198.18.133.200:19019 |    run  traceroute 10.11.1.1  from both hosts as show in below sreenshots      As show from the traceroute, ubuntu host from both remote sites are using DC1 as transit site to reach prefix  10.11.1.0/24  from legacy site.",
            "title": "Step1: Verify current route"
        },
        {
            "location": "/lab2/#step2-route-policy-for-remote2",
            "text": "The requirement for remote2 is to use DC as transit site and use transport  private2 . To achieve that, you can modify the central policy created in  lab1  to set higher OMP preference for prefix  10.11.1.0/24  from color  private2 .\n- login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies \n- Click  Custom Options  on the upper right corner and select  Lists  under  Centralized Policy  as show below.  \n- select  Prefix  and click  New Prefix List  to add prefix  10.11.1.0/24  for legacy site as show below. Click  Add  to save new prefix list  Legacy_prefix  .\n    Click  Custom Options  on the upper right corner and select  Topology  under  Centralized Policy .  Select Topology policy  LAB_Topo_RS2  created in lab1, and click the  \"...\"  to Edit.  Select  Route  under  Sequence Type  from the left.\n   Click  Sequence Rule  to add new rule. For omp route that matches  Legacy_prefix  and  private2  color, set  Preference  200.\n  \n #####    Note : After save, move the new created rule to the top by drag and drop the sequence number left to the rule.   Run  traceroute 10.11.1.1  again from Remote2 host and compare the path from previous output.\n    #### Step3: Route policy for Remote1  The requirement for remote1 is to use  private1  route directly to legacy site. To achieve that, you can leak prefix  10.11.1.0/24  from VPN0 into service VPN.  SP  private1  uses OSPF as PE-CE routing protocol; create OSPF feature template and attach to R1-WE1 VPN0.\n- login vManage  198.18.133.200  and access feature template from  Configuration - Template  then click  Feature \n- Click  Add Template  and select OSPF template as show below.\n  \n - Name the template:  Lab_OSPF_VPN0_V01 \n - Assign Router ID:  1.1.100.1 \n  \n - Add  connected  as protocol under  REDISTRIBUTE  section\n  \n - enable OSPF Area 0 on interface GigabitEthernet1\n  \n- Access device template from  Configuration - Template  then locate template  Lab_R1_V01 . Click  \"...\"  for more option and select Edit.\n - Move to  Transport & Management VPN  section, Add  Cisco OSPF  template and select  Lab_OSPF_VPN0_V01  from dropdown list.\n    \n- Update the device template and trigger vManage to update R1-VE1 configuration.\n- After vManage complete the push, SSH into  R1-WE1  to verify new OSPF neighbor and routes learned OSPF routes.\n  \n  \nConfigure route leaking between VPN0 and service VPN, so R1-WE1 will use the OSPF route learned from OSPF in VPN0 for prefix  10.11.1.0/24 \n- login vManage  198.18.133.200  and access feature template from  Configuration - Template  then click  Feature \n- Locate existing template  \"Lab_Remote_VPN1_V01\" . Click  \"...\"  for more option and select Edit.\n - Move to  Global Route Leak  section. Add OSPF under  Add New Route Leak from Global VPN to Service VPN   \n - Add connected under  Add New Route Leak from Service VPN to Global VPN   \n    \n - Update the template to trigger configuration push from vManage to R1-WE1  Note: As optional task, you can add route policy to limit the routes being leaked between Global and service VPN \n- SSH into R1-WE1 to verify route  10.10.101.0/24 being added in global route table\n  \n- SSH into R1-WE1 to verify route  10.11.1.0/24  being added in VRF 1 route table. The SP prefixes  172.1.x.0  are also leaked into service VPN which can be limited from additional route policy in previous step.\n  \n- Now let's verify the new route path from remote1 Ubuntu host. Run  traceroute 10.11.1.1  again from Remote1 host and compare the result from previous output.\n      Back to Top",
            "title": "Step2: Route policy for Remote2"
        },
        {
            "location": "/lab3/",
            "text": "Lab 3: Performance Optimization\n\n\n\n\nIn this section, you will help ACME to optimize their SD-WAN fabric. You will perform the following tasks in this lab.\n\n\n\n\nAdd QoS and make sure consistent QoS policies are applied across the SD-WAN fabric.\n\n\nRegional hub has higher bandwidth on WAN circuits compare to remote sites. This bandwidth mismatch could potentially cause packet drops on remote sites. Configure the sd-wan fabric to prevent this potential issue.\n\n\nDue to the latency sensitive application requirement, a spoke to spoke tunnel is needed between remote sites. Configure the sd-wan fabric to build on-demand tunnel between remote sites.\n\n\nCloud Application (16.16.16.16) requires inspection services on all users. Configure IPSec tunnel to SIG provider for inspection services and configure the sd-wan fabric to route all traffic to this application over a IPSec tunnel.  \n\n\nACME wants to reduce the bandwidth consumption on private WAN links. Configure the sd-wan fabric to route public cloud and Internet traffic over local internet access.\n\n\nFor SaaS application, configure the sd-wan fabric to use either local DIA or RH based on application performance.\n\n\n\n\n\n\nTask 1: QoS\n\n\nEnabling QoS has three main steps: classification, marking and queueing. Queueing policy is configured as Localized policy and applied on interface level. classification and marking can be enabled over Localized policy or over centralized data policy. ACME requires consistent QoS policies across sd-wan fabric, you will use centralized data policy to achieve that.\n\n\nACME uses 4-class QoS model with the following policy requirements.\n\n\n\n\n\n\n\n\nClass\n\n\nApplications\n\n\nDSCP Value\n\n\nQueueing\n\n\n\n\n\n\n\n\n\n\nREALTIME\n\n\nrtp,webex,zoom\n\n\nEF\n\n\n30%\n\n\n\n\n\n\nSIGNALING\n\n\nrtcp,mgcp,sip\n\n\nCS3\n\n\n10%\n\n\n\n\n\n\nCRITICAL\n\n\nSSH,SNMP,SMB\n\n\nAF31\n\n\n40%\n\n\n\n\n\n\nDEFAULT\n\n\n\n\n0\n\n\n20%\n\n\n\n\n\n\n\n\nStep1.1: class map and applications\n\n\n\n\n\n\nlogin vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies\n\n\n\n\n\n\nClick \nCustom Options\n drop down on the top right and select \nLists\n under \nLocalized Policy\n\n \n  \n\n\n\n\nClick \nClass Map\n list type on the left and add \nNew Class List\n. In the pop up window enter \nREALTIME\n in Class filed, and select \n0\n from Queue dropdown.\n \n  \n\n\nAfter save \nREALTIME\n class, add following three classes.\n\n\nclass: \nSIGNALING\n  Queue: \n1\n\n\nclass: \nCRITICAL\n Queue: \n3\n\n\nclass: \nDEFAULT\n  Queue: \n2\n\n\n\n\n\n\nClick \nCustom Options\n drop down on the top right and select \nLists\n under \nCentralized Policy\n\n \n     \n\n\n\n\n\n\nClick \nApplication\n list type on the left and add \nNew Application List\n. In the application configure window enter \nREALTIME\n in Application List Name, and select \"\nRTP\n, \nWebEX\n, \nZoom\n\" from Application drop list.\n \n\n\n\n\nAfter same \"REALTIME\" Application, add following two Applications\n\n\nApplication List Name: \nSIGNALING\n Application: \nReal Time Control Protocol, Media Gateway Control Protocol, Session Initiation Protocol\n\n\nApplication List Name: \nCRITICAL\n Application: \nSecure Shell, SImple Network Management Protocol, SMB\n\n  \n\n\n\n\nStep1.2: Central Data Policy for classification\n\n\n\n\n\n\nlogin vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies\n\n\n\n\n\n\nClick \nCustom Options\n drop down on the top right and select \nTraffic Policy\n under \nCentralized Policy\n\n\n\n\n\n\nSelect \nTraffic Data\n and select \nCreate New\n from Add Policy drop list\n  \n\n\n\n\nConfigure the data policy to match on  application list,  assign to forwarding class and DSCP value as show below.\n  \n\n\nAfter \nSave Data Policy\n, go back to the \nCentralized Policy\n configuration and edit central policy \nLAB_Central_V01\n\n  \n\n\nClick \nTraffic Rules\n tab on the top then click \nTraffic Data\n and select \nImport Existing\n to add QoS data policy \nLab_QoS_v01\n\n  \n\n\nClick \nPolicy Application\n tab on the top then click \nTraffic Data\n to assign the qos data policy.\n\n\nTo have consistent QoS policy for the fabric, We will apply the QoS policy to all sites and all VPNs on service side as below screenshot.\n  \n\n\nClick \nAdd\n and \nSave Policy Changes\n then \nActive\n the updated central policy.   \n\n\n\n\nStep1.3: Local QoS queuing policy\n\n\n\n\n\n\nlogin vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies\n\n\n\n\n\n\nClick \nCustom Options\n drop down on the top right and select \nforwarding Class/QoS\n under \nLocalized Policy\n\n\n\n\n\n\nSelect \nQoS Map\n and select \nAdd QoS Map\n to create new queuing policy \nLab_QoS_Map_v01\n\n\n\n\nClick \nAdd Queue\n to add policy for \nSIGNALING\n class as show below.\n   \n\n\nClick \nAdd Queue\n to add policy for \nCRITICAL\n class as show below\n   \n   \n\n\nClick \nAdd Queue\n to add policy for \nDEFAULT\n class as show below\n    \n\n\nThe QoS queuing policy will look similar to screenshot below.\n\n\n\nAfter queuing policy is created, we create localized policy that includes the queueing policy.\n\n\n\n\nNote: To save time, We will only create local policy for remote sites in this lab.\n\n- Click \nLocalized Policy\n tab and \nAdd Policy\n\n- Click \nNext\n move to \nconfigure Forwarding Classes/QoS\n\n- Click \nAdd QoS Map\n drop down and select import existing. Search \nLab_QoS_Map_v01\n and Import.\n- Click next to pass ACL and route policy config. On Policy Overview, give a nme for the local policy and check \nApplication\n at the bottom from Policy Settings.\n\n\n\nStep1.4: Apply QoS queuing policy\n\n\nApplying QoS queuing policy is two step process, first you need to associate the localized policy to the device template, and next you need reference the queueing policy-map on transport interface.\n\n\n\n\nAccess template configuration from \nConfiguration - Templates\n\n\nUnder \nDevice\n template tab, locate template \nLab_R1_V01\n and select \nEdit\n\n\nAssociate \nLab_Remote_VPN1_V01\n localized policy to the template as show below\n\n\n\nClick \nUpdate\n to push the new localized policy configuration.\n\n\nRepeat the above steps for template \nLab_R2_V01\n\n\n\n\nNow you have the localized policy associated with device template for both remotes. Next you need reference the queueing policy on transport interfaces.\n\n\n\n\nAccess template configuration from \nConfiguration - Templates\n\n\nUnder \nFeature\n template tab, locate template \nLab_Remote_VPN0_Private1_v01\n and select \nEdit\n\n\nUnder ACL/QOS section, hardcode \nLab_QoS_Map_v01\n for QoS Map field.\n\n\n\nclick update to push configuration change.\n\n\nRepeat the above steps to update   \nLab_Remote_VPN0_Private2_V01\n and \nLab_Remote_VPN0_LTE_V01\n feature templates.\n\n\nAfter queuing policy is applied on both transport interfaces, you can verify the QoS policy from CLI using command \nshow policy-map interface\n\n\n\n\nR2-WE1#show policy-map interface GigabitEthernet 2\n GigabitEthernet2\n\n  Service-policy output: Lab_QoS_Map_v01\n\n    queue stats for all priority classes:\n      Queueing\n      priority level 1\n      queue limit 512 packets\n      (queue depth/total drops/no-buffer drops) 0/0/0\n      (pkts output/bytes output) 22647/6060238\n\n    Class-map: Queue0 (match-any)\n      22647 packets, 6060238 bytes\n      30 second offered rate 15000 bps, drop rate 0000 bps\n      Match: qos-group 0\n      police:\n          rate 30 %\n          rate 300000000 bps, burst 9375000 bytes\n        conformed 22647 packets, 6060238 bytes; actions:\n          transmit\n        exceeded 0 packets, 0 bytes; actions:\n          drop\n        conformed 15000 bps, exceeded 0000 bps\n      Priority: Strict, b/w exceed drops: 0\n\n      Priority Level: 1\n\n    Class-map: Queue1 (match-any)\n      0 packets, 0 bytes\n      30 second offered rate 0000 bps, drop rate 0000 bps\n      Match: qos-group 1\n      Queueing\n      queue limit 1041 packets\n      (queue depth/total drops/no-buffer drops) 0/0/0\n      (pkts output/bytes output) 0/0\n      bandwidth remaining ratio 10\n\n    Class-map: Queue3 (match-any)\n      10268 packets, 1197729 bytes\n      30 second offered rate 0000 bps, drop rate 0000 bps\n      Match: qos-group 3\n      Queueing\n      queue limit 1041 packets\n      (queue depth/total drops/no-buffer drops) 0/0/0\n      (pkts output/bytes output) 10268/1197729\n      bandwidth remaining ratio 40\n\n    Class-map: class-default (match-any)\n      15 packets, 1609 bytes\n      30 second offered rate 0000 bps, drop rate 0000 bps\n      Match: any\n      Queueing\n      queue limit 1041 packets\n      (queue depth/total drops/no-buffer drops) 0/0/0\n      (pkts output/bytes output) 15/1609\n      bandwidth remaining ratio 20\n        Exp-weight-constant: 9 (1/512)\n        Mean queue depth: 0 packets\n        class       Transmitted         Random drop      Tail drop          Minimum        Maximum     Mark\n                pkts/bytes            pkts/bytes       pkts/bytes          thresh         thresh     prob\n\n        0               1/349             0/0              0/0                260           520  1/10\n        1               0/0               0/0              0/0                292           520  1/10\n        2               0/0               0/0              0/0                325           520  1/10\n        3               0/0               0/0              0/0                357           520  1/10\n        4               0/0               0/0              0/0                390           520  1/10\n        5               0/0               0/0              0/0                422           520  1/10\n        6              14/1260            0/0              0/0                455           520  1/10\n        7               0/0               0/0              0/0                487           520  1/10\n\n\n\n\nTask 2: per-tunnel QoS\n\n\nIn this section, you will configure the RH WAN edge router (\nRH-WE1\n) to shape tunnel traffic to each remote. This per-tunnel QoS will make sure RH cannot send excessive traffic to remotes and overrun it.\n\n\nStep2.1: Configure QoS policy on RH\n\n\n\n\nIn taks 1, you have configured QoS policy on remote sites. Follow the same steps to configure QoS policy on RH \nRH-WE1\n.\n\n\nlogin vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies - Localized Policy\n\n\nCopy polocy \nLAB_Remote_Local_v01\n and name new policy \nLAB_RH_Local_v01\n.\n\n\nAccess template configuration from \nConfiguration - Templates\n\n\nLocate device template \nLab_RH_V01\n and attach localized policy \nLAB_RH_Local_v01\n to the device template.  \n\n\nUpdate following feature templates\n\n\nLab_RH_VPN0_Private1_v01\n\n\nLab_RH_VPN0_Private2_V01\n\n\nLab_RH_VPN0_LTE_V01\n  \n\n\n\n\n\n\nUnder ACL/QOS section, hardcode \nLab_QoS_Map_v01\n for QoS Map field.\n\n\n\n\nStep2.2: Configure Hub role on RH\n\n\n\n\nAccess template configuration from \nConfiguration - Templates\n\n\nUnder \nFeature\n template tab, locate template \nLab_RH_VPN0_Private1_v01\n and select \nEdit\n  \n\n\nIn \nTUNNEL\n section, configure the following\n\n\nselect \nOn\n for \nPer-tunnel QoS\n to enable per-tunnel QoS\n\n\nselect \nOn\n for \nPer-tunnel QoS Aggregator\n to set this as hub tunnel\n\n\nConfigure \nTunnel Bandwidth Percent\n to \n80\n to set maximum bandwidth usage for overlay traffic\n\n\n\n\n\n\n\n\nLocate feature template \nLab_RH_VPN0_Private2_V01\n, and select \nEdit\n  \n\n\nIn \nTUNNEL\n section, configure the following\n\n\nselect \nOn\n for \nPer-tunnel QoS\n to enable per-tunnel QoS\n\n\nselect \nOn\n for \nPer-tunnel QoS Aggregator\n to set this as hub tunnel\n\n\nConfigure \nTunnel Bandwidth Percent\n to \n80\n to set maximum bandwidth usage for overlay traffic  \n\n\n\n\nStep2.3: Configure Spoke role on Remotes\n\n\n\n\nAccess template configuration from \nConfiguration - Templates\n\n\nUnder \nFeature\n template tab, locate template \nLab_Remote_VPN0_Private1_v01\n and select \nEdit\n\n\nIn \nTUNNEL\n section, configure \nOn\n for \nPer-tunnel QoS\n to enable per-tunnel QoS. Since this is spoke, we will leave \nPer-tunnel QoS Aggregator\n off.\n  \n\n\nTo configure a device as spoke role, you will also need to configure the downstream bandwidth.\n\n\n\n\nspecify the downstream bandwidth to 10Mbps for remote1\n  \n\n\n\n\n\n\nlocate template \nLab_Remote_VPN0_Private2_v01\n and select \nEdit\n\n\n\n\nIn \nTUNNEL\n section, configure \nOn\n for \nPer-tunnel QoS\n to enable per-tunnel QoS. Since this is spoke, we will leave \nPer-tunnel QoS Aggregator\n off.\n    \n\n\nTo configure a device as spoke role, you will also need to configure the downstream bandwidth.\n\n\nspecify the downstream bandwidth to 10Mbps for remote1\n    \n  \n\n\n\n\nStep2.4: Verify per-tunnel QOS\n\n\nTo verify per-tunnel QoS is working as configured. SSH into \nRH-WE1\n and run the commands as show below\n\n\nRH-WE1#show platform software sdwan qos policy\n============ Session QoS Policy Database ============\npolicy              bandwidth     remaining-ratio template\nSDWANPolicy4210704  10000000      1               Lab_QoS_Map_v01\nSDWANPolicy4210705  20000000      2               Lab_QoS_Map_v01\n\n\n\n\n\nRH-WE1#show platform software sdwan qos target\n============ Session QoS Target Database ============\nsrc-addr                 dst-addr                 sport   dport   proto remote-tloc     dummy-intf            tunnel         policy                bandwidth\n172.1.7.2                172.1.8.2                12346   12346   IPSEC 1.1.100.1       SDWANSession4210704   Tunnel1        SDWANPolicy4210704    10000\n172.2.6.2                172.2.7.2                12346   12346   IPSEC 1.1.102.1       SDWANSession4210705   Tunnel2        SDWANPolicy4210705    20000\n\n\n\n\nTask 3: On-demand Tunnel\n\n\nHub and Spoke topology can reduce the CPU and memory usage on WAN Edge, but sometime a spoke to spoke tunnel is needed. Dynamic on-demand tunnel offers the benefits of having direct spoke to spoke tunnel while keep the low CPU and memory usage on WAN Edge.\n\n\nTo improve latency of traffic between remotes, configure dynamic on-demand tunnel between remote1 and remote2.\n\n\nStep3.1: Modify central control policy\n\n\nIn Lab1 you have created hub and spoke topology for both remote sites. In order to create dynamic on-demand tunnel between remotes, first you need modify the topology policy to include a \ntloc-action backup\n action.\n- login vManage \n198.18.133.200\n and access policy configuration from \nConfiguration - Policies\n\n\n\n\n\n\nClick \nCustom Options\n drop down on the top right and select \nTopology\n under \nCentralized Policy\n\n\n\n\n\n\nHighlight topology policy \nLAB_Topo_RS1\n and select \nEdit\n\n\n\n\nClick \nTLOC\n from \nSequence Type\n on the left\n\n\nClick \nSequence Rule\n to add a new rule; configure the rule to match on site list \nAll-Remotes\n, Actions \nAccept\n. \nSave Match And Actions\n to add this new rule.\n    \n\n\nClick \nRoute\n from \nSequence Type\n on the left\n    \n\n\nClick \nSequence Rule\n to add a new rule; configure the rule to match on site list \nAll-Remotes\n, Actions TLOC list \nRH-Tlocs\n and TLOC Action \nBackup\n.\n    \n\n\nAfter \nSave Match and And Actions\n, drag and drop the newly created rule to seq # 1.\n  \n\n\nFollow the same steps to modify topology policy \nLAB_Topo_RS2\n.\n\n\n\n\nStep3.2: Configure On-demand Tunnel\n\n\nEnable Traffic Engineering service on RH to allow RH becomes backup path.\n- Access template configuration from \nConfiguration - Templates\n\n- Under \nFeature\n template tab, locate template \nLab_RH_VPN0_v01\n and select \nEdit\n\n- In \nSERVICE\n section, add \nTE\n from service type drop down, and add it to this feature template.\n  \n\n- Update and push configure change.\n\n\nOn remote sites, R1-WE1 and R2-WE2, enable on-demand on system template.\n-  Under \nFeature\n template tab, locate template \nLab_System_V01\n and select \nCopy\n\n- Name new system template \nLab_Remote_System_V01\n\n- Edit \nLab_Remote_System_V01\n to enable \nOn-demand Tunnel\n\n  \n\n- locate device template \nLab_R1_V01\n and change system template to \nLab_Remote_System_V01\n\n    \n\n    update and push configuration change.\n- locate device template \nLab_R2_V01\n and change system template to \nLab_Remote_System_V01\n. update and push configuration change.\n\n\nStep3.3: Verify On-demand Tunnel between remotes\n\n\nYou can verify the dynamic tunnel between remotes from vManage.\n- login vManage \n198.18.133.200\n and access \nMonitor - Network\n\n- select WAN-Edge \nR1-WE1\n\n    \n\n- Click \nReal Time\n and type in \non demand local\n in \nDevice Options\n filed\n    \n\n- The output shows local on demand tunnel is enabled and status is active.\n    \n\n- type in \non demand remote\n in \nDevice Options\n filed  \n\n- the output shows remote on demand tunnel to remote2 \n1.1.102.1\n is enabled and tunnel status is \ninactive\n\n    \n\n- Dynamic on demand tunnel is triggered by traffic between the local and remote sites. That's why you see status of on demand remote is inactive. Let's generate bi-directional traffic between remote1 and remote2 to trigger on demand tunnel.\n- ssh into \nR1-VM1\n, and type \nssh 10.10.102.10\n to login \nR2-VM2\n with credential \nviptela/viptela\n\n\nWelcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.8.0-36-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n689 packages can be updated.\n475 updates are security updates.\nLast login: Mon Feb  8 09:22:21 2021 from 10.16.22.163\nviptela@remote1_ubuntu:~$ ssh 10.10.102.10\nviptela@10.10.102.10's password:\nWelcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.8.0-36-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n711 packages can be updated.\n521 updates are security updates.\nLast login: Mon Feb  8 09:25:00 2021 from 10.10.101.10\nviptela@remote2_ubuntu:~$\n\n\n\n\n\n\nGo back to \nvManage - Monitor - Network - R1-WE1 - Real time\n and type in \non demand remote\n in \nDevice Options\n filed.\n\n\nverify the tunnel status for on demand tunnel to remote2 \n1.1.102.1\n changes \nactive\n    \n\n    \n\n\n\n\nTask 4: IPsec tunnel to SIG\n\n\nInspection service is required for traffic to cloud application with IP \n16.16.16.16\n. Configure remote1 and remote2 to build an IPSec tunnel to SIG provider. Route all traffic to \n16.16.16.16\n for inspection.\n\n\nStep4.1 : Manual IPSec tunnel to SIG\n\n\nBefore configuring the IPSec tunnel, verify the connectivity to Cloud application at \n16.16.16.16\n from remote ubuntu hosts. It is expected to see the application is not reachable.\n\n\n\nviptela@remote1_ubuntu:~$ ping 16.16.16.16\nPING 16.16.16.16 (16.16.16.16) 56(84) bytes of data.\n\n\n\n\n\nConfigure IPSec tunnel on remote1 and remote2 to match the pre-configured tunnel at SIG provider.\n\n\n\n\n\n\n\n\nsite\n\n\ntunnel IP\n\n\ntunnel source\n\n\ntunnel destination\n\n\nIKE version\n\n\npre-share key\n\n\n\n\n\n\n\n\n\n\nRemote1\n\n\n172.4.101.1/24\n\n\nGigabitEthernet2\n\n\n172.3.2.2\n\n\nIKE v1\n\n\ncisco123\n\n\n\n\n\n\nRemote2\n\n\n172.4.102.1/24\n\n\nGigabitEthernet2\n\n\n172.3.2.2\n\n\nIKE v1\n\n\ncisco123\n\n\n\n\n\n\n\n\nIsakmp policy\n\n\nencryption algorithm:   AES - Advanced Encryption Standard (256 bit keys).\nhash algorithm:         Secure Hash Standard\nauthentication method:  Pre-Shared Key\nDiffie-Hellman group:   #16 (4096 bit)\nlifetime:               14400 seconds, no volume limit\n\n\n\n\nIPSec policy\n\n\nSecurity association lifetime:3600 seconds\nPFS (Y/N): Y\nDH group:  group16\nMixed-mode : Disabled\nTransform sets=esp-aes esp-sha-hmac\nAntireplay window size = 512\n\n\n\n\n\n\nlogin vManage \n198.18.133.200\n and access template configuration from \nConfiguration - Templates - Feature\n\n\nAdd new IPsec interface feature template as show below\n \n\n\nConfigure the template with following fields and leave other fields as default value\n|filed name|value|\n|---|---|\n|Template Name|Lab_IPsec_Int_V01|\n|Description|Lab_IPsec_Int_V01|\n|Shutdown|No|\n|Interface Name|ipsec1|\n|IPv4 address|ipsec_tun_ip|\n|source|Interface|\n|IPsec Source Interface|GigabitEthernet2|\n|IPsec Destination IP Address|172.3.2.2|\n|Preshared Key|cisco123|\n\n\n\n\n\n\n\n\nAdd tunnel feature template \nLab_IPsec_Int_V01\n to device template \nLab_R1_V01\n and \nLab_R2_V01\n\n\nLocate device template \nLab_R1_V01\n click Edit\n\n\nAdd \nLab_IPsec_Int_V01\n under VPN0\n \n\n\nclick save to update and filed in \n172.4.101.1/24\n for tunnel IP Address\n \n\n\nLocate device template \nLab_R2_V01\n click Edit\n\n\nAdd \nLab_IPsec_Int_V01\n under VPN0\n\n\nclick save to update and filed in \n172.4.102.1/24\n for tunnel IP Address\n \n\n\nThe ipsec tunnel will be \nUP\n on both remote sites. You can verify the tunnel status from \nshow ip interface brief\n\n\n\n\nR2-WE1#sh ip int b\nInterface              IP-Address      OK? Method Status                Protocol\nGigabitEthernet1       172.2.7.2       YES other  up                    up\nGigabitEthernet2       172.3.9.7       YES DHCP   up                    up\nGigabitEthernet3       unassigned      YES other  down                  down\nGigabitEthernet4       10.10.102.1     YES other  up                    up\nGigabitEthernet5       unassigned      YES other  down                  down\nGigabitEthernet6       unassigned      YES other  down                  down\nGigabitEthernet7       unassigned      YES other  down                  down\nGigabitEthernet8       192.168.150.19  YES other  up                    up\nSdwan-system-intf      1.1.102.1       YES unset  up                    up\nLoopback65528          192.168.1.1     YES other  up                    up\nNVI0                   unassigned      YES unset  up                    up\nTunnel1                172.2.7.2       YES TFTP   up                    up\nTunnel2                172.3.9.7       YES TFTP   up                    up\nTunnel100001           172.4.102.1     YES other  up                    up\nR2-WE1#\n\n\n\n\nR1-WE1#sh ip int b\nInterface              IP-Address      OK? Method Status                Protocol\nGigabitEthernet1       172.1.8.2       YES other  up                    up\nGigabitEthernet2       172.3.8.7       YES DHCP   up                    up\nGigabitEthernet3       10.10.101.1     YES other  up                    up\nGigabitEthernet4       unassigned      YES other  down                  down\nGigabitEthernet5       unassigned      YES other  down                  down\nGigabitEthernet6       unassigned      YES other  down                  down\nGigabitEthernet7       unassigned      YES other  down                  down\nGigabitEthernet8       192.168.150.16  YES other  up                    up\nSdwan-system-intf      1.1.100.1       YES unset  up                    up\nLoopback65528          192.168.1.1     YES other  up                    up\nNVI0                   unassigned      YES unset  up                    up\nTunnel1                172.1.8.2       YES TFTP   up                    up\nTunnel2                172.3.8.7       YES TFTP   up                    up\nTunnel100001           172.4.101.1     YES other  up                    up\nR1-WE1#\n\n\n\n\n\n\nNext you need to route all traffic to cloud application \n16.16.16.16\n to the tunnel.\n\n\nlocate feature template \nLab_Remote_VPN1_V01\n and edit\n\n\nIn \nIPSEC ROUTE\n section, add \nNew IPSEC Route\n with prefix \n16.16.16.16/32\n interface \nipsec1\n\n\n\n\n\n\n\n\nclick update to push configure change to both remote sites.\n\n\n\n\nStep4.2 : verify SIG tunnel\n\n\n\n\n\n\nVNC login \nR1-VM1\n and \nR2-VM1\n with credential \nviptela\n\n\n\n\n\n\nverify that you can ping \n16.16.16.16\n from the VM\n  \n\n\n\n\nnow try access \n16.16.16.16\n from browser. You should see this login page\n  \n\n\n\n\nTask 5: DIA\n\n\nThere are two options to enable DIA.\n- option 1: NAT DIA Route\n\n\n\nIn this option, a NAT route is configured under service VPN. You can direct local internet traffic from service VPN to transport VPN.\n- option 2: Centralized data policy\n  \n\n\nIn this option, a centralized policy is applied to service side traffic based on ip prefixes, a match will redirect to transport VPN. Traffic that doesnt match the policy will stay in service VPN and route over IPSec tunnel.\n\n\nIn this task, you are going to configure DIA on remote sites using option 2.       \n\n\nTask 6: CoR for SaaS\n\n\nInstead of using the DIA exit point as configured in previous task, for SaaS application box and salesforce, ACME wants to use the most optimal path. Configure the remote sites to dynamically chose local DIA or regional hub as exit point for box and salesforce based on application performance.\n  \n\n\nStep6.1 Enable Cloud OnRamp for SaaS\n\n\n\n\nlogin vManage \n198.18.133.200\n and access \nAdministration - Settings\n\n\nEdit \nCloud onRamp for SaaS\n and check \nEnabled\n\n  \n\n\n\n\nStep6.2 Add SaaS application\n\n\n\n\nAccess CoR SaaS configuration via \nConfiguration - Cloud onRamp for SaaS\n  \n\n\n\n\nFrom \nManage Cloud OnRamp for SaaS\n dropdown, select \nApplications and Policy\n\n  \n\n\n\n\n\n\nSelect \nBox\n and \nSalesforce\n from the application list; Select \nEnabled\n for Monitoring dropdown list; Enter \n1\n for VPN; Select \nEnabled\n for Policy/Cloud SLA dropdown list.\n\n\n\n\n\n\n\n- Cloud OnRamp for SaaS uses existing AAR policy, we will keep the system created policy for SaaS. Click \nSave Policy\n to proceed the policy update.\n  \n\n\nStep6.3 Add sites\n\n\nYou are going to configure remote sites as DIA site, and Regional hub as gateway site. Remote sites will monitor the QoE score for local DIA via LTE transport, and also the QoE score for gateway site.\n- Access CoR SaaS configuration via \nConfiguration - Cloud onRamp for SaaS\n\n- Click \nManage Cloud OnRamp for SaaS\n dropdown list on the upper left, and select \nGateway\n\n  \n\n- Click \nAttach Gateways\n,  select \nRH-WE1\n and move it to \nselected Sites\n. Click \nAdd interfaces to selected sites\n.\n  \n\n- In the pop up window, under \nInterface\n field select interface \nGigabitEthernet4\n from the list. This will allow gateway site sends\n\n   \n\n- Click \nManage Cloud OnRamp for SaaS\n dropdown list on the upper left, and select \nDIA Sites\n\n   \n\n- select \nAttach DIA Sites\n, select \nR1-WE1\n and \nR2-WE1\n and move it to \nselected Sites\n.     \n\n   \n  \n\n\nStep6.4 Verify CoR SaaS\n\n\nClick \nManage Cloud OnRamp for SaaS\n to verify QoE status, DIA status, exit interface on each WAN Edge for SaaS application.  \n\n   \n\n\nNote: Your output may not match the screenshot on the vQoE score and DIA Status. This is expected.\n\n- screenshot above shows both remote sites are using local DIA as exit point for box and Salesfoce SaaS application.\n- This lab doesn't have traffic impairment tool, we can't increase remote transport's latency or drop to trigger SaaS changes exit point. But if you keep checking the SaaS status, you will notice the vQoE score changes and exit interface changes.\n   \n\n\n\n\nCongratulation! You have completed the whole lab.\n\n\nBack to Top",
            "title": "Lab 3 Tasks"
        },
        {
            "location": "/lab3/#lab-3-performance-optimization",
            "text": "In this section, you will help ACME to optimize their SD-WAN fabric. You will perform the following tasks in this lab.   Add QoS and make sure consistent QoS policies are applied across the SD-WAN fabric.  Regional hub has higher bandwidth on WAN circuits compare to remote sites. This bandwidth mismatch could potentially cause packet drops on remote sites. Configure the sd-wan fabric to prevent this potential issue.  Due to the latency sensitive application requirement, a spoke to spoke tunnel is needed between remote sites. Configure the sd-wan fabric to build on-demand tunnel between remote sites.  Cloud Application (16.16.16.16) requires inspection services on all users. Configure IPSec tunnel to SIG provider for inspection services and configure the sd-wan fabric to route all traffic to this application over a IPSec tunnel.    ACME wants to reduce the bandwidth consumption on private WAN links. Configure the sd-wan fabric to route public cloud and Internet traffic over local internet access.  For SaaS application, configure the sd-wan fabric to use either local DIA or RH based on application performance.",
            "title": "Lab 3: Performance Optimization"
        },
        {
            "location": "/lab3/#task-1-qos",
            "text": "Enabling QoS has three main steps: classification, marking and queueing. Queueing policy is configured as Localized policy and applied on interface level. classification and marking can be enabled over Localized policy or over centralized data policy. ACME requires consistent QoS policies across sd-wan fabric, you will use centralized data policy to achieve that.  ACME uses 4-class QoS model with the following policy requirements.     Class  Applications  DSCP Value  Queueing      REALTIME  rtp,webex,zoom  EF  30%    SIGNALING  rtcp,mgcp,sip  CS3  10%    CRITICAL  SSH,SNMP,SMB  AF31  40%    DEFAULT   0  20%",
            "title": "Task 1: QoS"
        },
        {
            "location": "/lab3/#step11-class-map-and-applications",
            "text": "login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies    Click  Custom Options  drop down on the top right and select  Lists  under  Localized Policy \n       Click  Class Map  list type on the left and add  New Class List . In the pop up window enter  REALTIME  in Class filed, and select  0  from Queue dropdown.\n      After save  REALTIME  class, add following three classes.  class:  SIGNALING   Queue:  1  class:  CRITICAL  Queue:  3  class:  DEFAULT   Queue:  2    Click  Custom Options  drop down on the top right and select  Lists  under  Centralized Policy \n           Click  Application  list type on the left and add  New Application List . In the application configure window enter  REALTIME  in Application List Name, and select \" RTP ,  WebEX ,  Zoom \" from Application drop list.\n    After same \"REALTIME\" Application, add following two Applications  Application List Name:  SIGNALING  Application:  Real Time Control Protocol, Media Gateway Control Protocol, Session Initiation Protocol  Application List Name:  CRITICAL  Application:  Secure Shell, SImple Network Management Protocol, SMB",
            "title": "Step1.1: class map and applications"
        },
        {
            "location": "/lab3/#step12-central-data-policy-for-classification",
            "text": "login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies    Click  Custom Options  drop down on the top right and select  Traffic Policy  under  Centralized Policy    Select  Traffic Data  and select  Create New  from Add Policy drop list\n     Configure the data policy to match on  application list,  assign to forwarding class and DSCP value as show below.\n    After  Save Data Policy , go back to the  Centralized Policy  configuration and edit central policy  LAB_Central_V01 \n    Click  Traffic Rules  tab on the top then click  Traffic Data  and select  Import Existing  to add QoS data policy  Lab_QoS_v01 \n    Click  Policy Application  tab on the top then click  Traffic Data  to assign the qos data policy.  To have consistent QoS policy for the fabric, We will apply the QoS policy to all sites and all VPNs on service side as below screenshot.\n    Click  Add  and  Save Policy Changes  then  Active  the updated central policy.",
            "title": "Step1.2: Central Data Policy for classification"
        },
        {
            "location": "/lab3/#step13-local-qos-queuing-policy",
            "text": "login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies    Click  Custom Options  drop down on the top right and select  forwarding Class/QoS  under  Localized Policy    Select  QoS Map  and select  Add QoS Map  to create new queuing policy  Lab_QoS_Map_v01   Click  Add Queue  to add policy for  SIGNALING  class as show below.\n     Click  Add Queue  to add policy for  CRITICAL  class as show below\n         Click  Add Queue  to add policy for  DEFAULT  class as show below\n      The QoS queuing policy will look similar to screenshot below.  After queuing policy is created, we create localized policy that includes the queueing policy.   Note: To save time, We will only create local policy for remote sites in this lab. \n- Click  Localized Policy  tab and  Add Policy \n- Click  Next  move to  configure Forwarding Classes/QoS \n- Click  Add QoS Map  drop down and select import existing. Search  Lab_QoS_Map_v01  and Import.\n- Click next to pass ACL and route policy config. On Policy Overview, give a nme for the local policy and check  Application  at the bottom from Policy Settings.",
            "title": "Step1.3: Local QoS queuing policy"
        },
        {
            "location": "/lab3/#step14-apply-qos-queuing-policy",
            "text": "Applying QoS queuing policy is two step process, first you need to associate the localized policy to the device template, and next you need reference the queueing policy-map on transport interface.   Access template configuration from  Configuration - Templates  Under  Device  template tab, locate template  Lab_R1_V01  and select  Edit  Associate  Lab_Remote_VPN1_V01  localized policy to the template as show below  Click  Update  to push the new localized policy configuration.  Repeat the above steps for template  Lab_R2_V01   Now you have the localized policy associated with device template for both remotes. Next you need reference the queueing policy on transport interfaces.   Access template configuration from  Configuration - Templates  Under  Feature  template tab, locate template  Lab_Remote_VPN0_Private1_v01  and select  Edit  Under ACL/QOS section, hardcode  Lab_QoS_Map_v01  for QoS Map field.  click update to push configuration change.  Repeat the above steps to update    Lab_Remote_VPN0_Private2_V01  and  Lab_Remote_VPN0_LTE_V01  feature templates.  After queuing policy is applied on both transport interfaces, you can verify the QoS policy from CLI using command  show policy-map interface   R2-WE1#show policy-map interface GigabitEthernet 2\n GigabitEthernet2\n\n  Service-policy output: Lab_QoS_Map_v01\n\n    queue stats for all priority classes:\n      Queueing\n      priority level 1\n      queue limit 512 packets\n      (queue depth/total drops/no-buffer drops) 0/0/0\n      (pkts output/bytes output) 22647/6060238\n\n    Class-map: Queue0 (match-any)\n      22647 packets, 6060238 bytes\n      30 second offered rate 15000 bps, drop rate 0000 bps\n      Match: qos-group 0\n      police:\n          rate 30 %\n          rate 300000000 bps, burst 9375000 bytes\n        conformed 22647 packets, 6060238 bytes; actions:\n          transmit\n        exceeded 0 packets, 0 bytes; actions:\n          drop\n        conformed 15000 bps, exceeded 0000 bps\n      Priority: Strict, b/w exceed drops: 0\n\n      Priority Level: 1\n\n    Class-map: Queue1 (match-any)\n      0 packets, 0 bytes\n      30 second offered rate 0000 bps, drop rate 0000 bps\n      Match: qos-group 1\n      Queueing\n      queue limit 1041 packets\n      (queue depth/total drops/no-buffer drops) 0/0/0\n      (pkts output/bytes output) 0/0\n      bandwidth remaining ratio 10\n\n    Class-map: Queue3 (match-any)\n      10268 packets, 1197729 bytes\n      30 second offered rate 0000 bps, drop rate 0000 bps\n      Match: qos-group 3\n      Queueing\n      queue limit 1041 packets\n      (queue depth/total drops/no-buffer drops) 0/0/0\n      (pkts output/bytes output) 10268/1197729\n      bandwidth remaining ratio 40\n\n    Class-map: class-default (match-any)\n      15 packets, 1609 bytes\n      30 second offered rate 0000 bps, drop rate 0000 bps\n      Match: any\n      Queueing\n      queue limit 1041 packets\n      (queue depth/total drops/no-buffer drops) 0/0/0\n      (pkts output/bytes output) 15/1609\n      bandwidth remaining ratio 20\n        Exp-weight-constant: 9 (1/512)\n        Mean queue depth: 0 packets\n        class       Transmitted         Random drop      Tail drop          Minimum        Maximum     Mark\n                pkts/bytes            pkts/bytes       pkts/bytes          thresh         thresh     prob\n\n        0               1/349             0/0              0/0                260           520  1/10\n        1               0/0               0/0              0/0                292           520  1/10\n        2               0/0               0/0              0/0                325           520  1/10\n        3               0/0               0/0              0/0                357           520  1/10\n        4               0/0               0/0              0/0                390           520  1/10\n        5               0/0               0/0              0/0                422           520  1/10\n        6              14/1260            0/0              0/0                455           520  1/10\n        7               0/0               0/0              0/0                487           520  1/10",
            "title": "Step1.4: Apply QoS queuing policy"
        },
        {
            "location": "/lab3/#task-2-per-tunnel-qos",
            "text": "In this section, you will configure the RH WAN edge router ( RH-WE1 ) to shape tunnel traffic to each remote. This per-tunnel QoS will make sure RH cannot send excessive traffic to remotes and overrun it.",
            "title": "Task 2: per-tunnel QoS"
        },
        {
            "location": "/lab3/#step21-configure-qos-policy-on-rh",
            "text": "In taks 1, you have configured QoS policy on remote sites. Follow the same steps to configure QoS policy on RH  RH-WE1 .  login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies - Localized Policy  Copy polocy  LAB_Remote_Local_v01  and name new policy  LAB_RH_Local_v01 .  Access template configuration from  Configuration - Templates  Locate device template  Lab_RH_V01  and attach localized policy  LAB_RH_Local_v01  to the device template.    Update following feature templates  Lab_RH_VPN0_Private1_v01  Lab_RH_VPN0_Private2_V01  Lab_RH_VPN0_LTE_V01       Under ACL/QOS section, hardcode  Lab_QoS_Map_v01  for QoS Map field.",
            "title": "Step2.1: Configure QoS policy on RH"
        },
        {
            "location": "/lab3/#step22-configure-hub-role-on-rh",
            "text": "Access template configuration from  Configuration - Templates  Under  Feature  template tab, locate template  Lab_RH_VPN0_Private1_v01  and select  Edit     In  TUNNEL  section, configure the following  select  On  for  Per-tunnel QoS  to enable per-tunnel QoS  select  On  for  Per-tunnel QoS Aggregator  to set this as hub tunnel  Configure  Tunnel Bandwidth Percent  to  80  to set maximum bandwidth usage for overlay traffic     Locate feature template  Lab_RH_VPN0_Private2_V01 , and select  Edit     In  TUNNEL  section, configure the following  select  On  for  Per-tunnel QoS  to enable per-tunnel QoS  select  On  for  Per-tunnel QoS Aggregator  to set this as hub tunnel  Configure  Tunnel Bandwidth Percent  to  80  to set maximum bandwidth usage for overlay traffic",
            "title": "Step2.2: Configure Hub role on RH"
        },
        {
            "location": "/lab3/#step23-configure-spoke-role-on-remotes",
            "text": "Access template configuration from  Configuration - Templates  Under  Feature  template tab, locate template  Lab_Remote_VPN0_Private1_v01  and select  Edit  In  TUNNEL  section, configure  On  for  Per-tunnel QoS  to enable per-tunnel QoS. Since this is spoke, we will leave  Per-tunnel QoS Aggregator  off.\n    To configure a device as spoke role, you will also need to configure the downstream bandwidth.   specify the downstream bandwidth to 10Mbps for remote1\n      locate template  Lab_Remote_VPN0_Private2_v01  and select  Edit   In  TUNNEL  section, configure  On  for  Per-tunnel QoS  to enable per-tunnel QoS. Since this is spoke, we will leave  Per-tunnel QoS Aggregator  off.\n      To configure a device as spoke role, you will also need to configure the downstream bandwidth.  specify the downstream bandwidth to 10Mbps for remote1",
            "title": "Step2.3: Configure Spoke role on Remotes"
        },
        {
            "location": "/lab3/#step24-verify-per-tunnel-qos",
            "text": "To verify per-tunnel QoS is working as configured. SSH into  RH-WE1  and run the commands as show below  RH-WE1#show platform software sdwan qos policy\n============ Session QoS Policy Database ============\npolicy              bandwidth     remaining-ratio template\nSDWANPolicy4210704  10000000      1               Lab_QoS_Map_v01\nSDWANPolicy4210705  20000000      2               Lab_QoS_Map_v01  RH-WE1#show platform software sdwan qos target\n============ Session QoS Target Database ============\nsrc-addr                 dst-addr                 sport   dport   proto remote-tloc     dummy-intf            tunnel         policy                bandwidth\n172.1.7.2                172.1.8.2                12346   12346   IPSEC 1.1.100.1       SDWANSession4210704   Tunnel1        SDWANPolicy4210704    10000\n172.2.6.2                172.2.7.2                12346   12346   IPSEC 1.1.102.1       SDWANSession4210705   Tunnel2        SDWANPolicy4210705    20000",
            "title": "Step2.4: Verify per-tunnel QOS"
        },
        {
            "location": "/lab3/#task-3-on-demand-tunnel",
            "text": "Hub and Spoke topology can reduce the CPU and memory usage on WAN Edge, but sometime a spoke to spoke tunnel is needed. Dynamic on-demand tunnel offers the benefits of having direct spoke to spoke tunnel while keep the low CPU and memory usage on WAN Edge.  To improve latency of traffic between remotes, configure dynamic on-demand tunnel between remote1 and remote2.",
            "title": "Task 3: On-demand Tunnel"
        },
        {
            "location": "/lab3/#step31-modify-central-control-policy",
            "text": "In Lab1 you have created hub and spoke topology for both remote sites. In order to create dynamic on-demand tunnel between remotes, first you need modify the topology policy to include a  tloc-action backup  action.\n- login vManage  198.18.133.200  and access policy configuration from  Configuration - Policies    Click  Custom Options  drop down on the top right and select  Topology  under  Centralized Policy    Highlight topology policy  LAB_Topo_RS1  and select  Edit   Click  TLOC  from  Sequence Type  on the left  Click  Sequence Rule  to add a new rule; configure the rule to match on site list  All-Remotes , Actions  Accept .  Save Match And Actions  to add this new rule.\n      Click  Route  from  Sequence Type  on the left\n      Click  Sequence Rule  to add a new rule; configure the rule to match on site list  All-Remotes , Actions TLOC list  RH-Tlocs  and TLOC Action  Backup .\n      After  Save Match and And Actions , drag and drop the newly created rule to seq # 1.\n    Follow the same steps to modify topology policy  LAB_Topo_RS2 .",
            "title": "Step3.1: Modify central control policy"
        },
        {
            "location": "/lab3/#step32-configure-on-demand-tunnel",
            "text": "Enable Traffic Engineering service on RH to allow RH becomes backup path.\n- Access template configuration from  Configuration - Templates \n- Under  Feature  template tab, locate template  Lab_RH_VPN0_v01  and select  Edit \n- In  SERVICE  section, add  TE  from service type drop down, and add it to this feature template.\n   \n- Update and push configure change.  On remote sites, R1-WE1 and R2-WE2, enable on-demand on system template.\n-  Under  Feature  template tab, locate template  Lab_System_V01  and select  Copy \n- Name new system template  Lab_Remote_System_V01 \n- Edit  Lab_Remote_System_V01  to enable  On-demand Tunnel \n   \n- locate device template  Lab_R1_V01  and change system template to  Lab_Remote_System_V01 \n     \n    update and push configuration change.\n- locate device template  Lab_R2_V01  and change system template to  Lab_Remote_System_V01 . update and push configuration change.",
            "title": "Step3.2: Configure On-demand Tunnel"
        },
        {
            "location": "/lab3/#step33-verify-on-demand-tunnel-between-remotes",
            "text": "You can verify the dynamic tunnel between remotes from vManage.\n- login vManage  198.18.133.200  and access  Monitor - Network \n- select WAN-Edge  R1-WE1 \n     \n- Click  Real Time  and type in  on demand local  in  Device Options  filed\n     \n- The output shows local on demand tunnel is enabled and status is active.\n     \n- type in  on demand remote  in  Device Options  filed   \n- the output shows remote on demand tunnel to remote2  1.1.102.1  is enabled and tunnel status is  inactive \n     \n- Dynamic on demand tunnel is triggered by traffic between the local and remote sites. That's why you see status of on demand remote is inactive. Let's generate bi-directional traffic between remote1 and remote2 to trigger on demand tunnel.\n- ssh into  R1-VM1 , and type  ssh 10.10.102.10  to login  R2-VM2  with credential  viptela/viptela  Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.8.0-36-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n689 packages can be updated.\n475 updates are security updates.\nLast login: Mon Feb  8 09:22:21 2021 from 10.16.22.163\nviptela@remote1_ubuntu:~$ ssh 10.10.102.10\nviptela@10.10.102.10's password:\nWelcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.8.0-36-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n711 packages can be updated.\n521 updates are security updates.\nLast login: Mon Feb  8 09:25:00 2021 from 10.10.101.10\nviptela@remote2_ubuntu:~$   Go back to  vManage - Monitor - Network - R1-WE1 - Real time  and type in  on demand remote  in  Device Options  filed.  verify the tunnel status for on demand tunnel to remote2  1.1.102.1  changes  active",
            "title": "Step3.3: Verify On-demand Tunnel between remotes"
        },
        {
            "location": "/lab3/#task-4-ipsec-tunnel-to-sig",
            "text": "Inspection service is required for traffic to cloud application with IP  16.16.16.16 . Configure remote1 and remote2 to build an IPSec tunnel to SIG provider. Route all traffic to  16.16.16.16  for inspection.",
            "title": "Task 4: IPsec tunnel to SIG"
        },
        {
            "location": "/lab3/#step41-manual-ipsec-tunnel-to-sig",
            "text": "Before configuring the IPSec tunnel, verify the connectivity to Cloud application at  16.16.16.16  from remote ubuntu hosts. It is expected to see the application is not reachable.  \nviptela@remote1_ubuntu:~$ ping 16.16.16.16\nPING 16.16.16.16 (16.16.16.16) 56(84) bytes of data.  Configure IPSec tunnel on remote1 and remote2 to match the pre-configured tunnel at SIG provider.     site  tunnel IP  tunnel source  tunnel destination  IKE version  pre-share key      Remote1  172.4.101.1/24  GigabitEthernet2  172.3.2.2  IKE v1  cisco123    Remote2  172.4.102.1/24  GigabitEthernet2  172.3.2.2  IKE v1  cisco123     Isakmp policy  encryption algorithm:   AES - Advanced Encryption Standard (256 bit keys).\nhash algorithm:         Secure Hash Standard\nauthentication method:  Pre-Shared Key\nDiffie-Hellman group:   #16 (4096 bit)\nlifetime:               14400 seconds, no volume limit  IPSec policy  Security association lifetime:3600 seconds\nPFS (Y/N): Y\nDH group:  group16\nMixed-mode : Disabled\nTransform sets=esp-aes esp-sha-hmac\nAntireplay window size = 512   login vManage  198.18.133.200  and access template configuration from  Configuration - Templates - Feature  Add new IPsec interface feature template as show below\n   Configure the template with following fields and leave other fields as default value\n|filed name|value|\n|---|---|\n|Template Name|Lab_IPsec_Int_V01|\n|Description|Lab_IPsec_Int_V01|\n|Shutdown|No|\n|Interface Name|ipsec1|\n|IPv4 address|ipsec_tun_ip|\n|source|Interface|\n|IPsec Source Interface|GigabitEthernet2|\n|IPsec Destination IP Address|172.3.2.2|\n|Preshared Key|cisco123|     Add tunnel feature template  Lab_IPsec_Int_V01  to device template  Lab_R1_V01  and  Lab_R2_V01  Locate device template  Lab_R1_V01  click Edit  Add  Lab_IPsec_Int_V01  under VPN0\n   click save to update and filed in  172.4.101.1/24  for tunnel IP Address\n   Locate device template  Lab_R2_V01  click Edit  Add  Lab_IPsec_Int_V01  under VPN0  click save to update and filed in  172.4.102.1/24  for tunnel IP Address\n   The ipsec tunnel will be  UP  on both remote sites. You can verify the tunnel status from  show ip interface brief   R2-WE1#sh ip int b\nInterface              IP-Address      OK? Method Status                Protocol\nGigabitEthernet1       172.2.7.2       YES other  up                    up\nGigabitEthernet2       172.3.9.7       YES DHCP   up                    up\nGigabitEthernet3       unassigned      YES other  down                  down\nGigabitEthernet4       10.10.102.1     YES other  up                    up\nGigabitEthernet5       unassigned      YES other  down                  down\nGigabitEthernet6       unassigned      YES other  down                  down\nGigabitEthernet7       unassigned      YES other  down                  down\nGigabitEthernet8       192.168.150.19  YES other  up                    up\nSdwan-system-intf      1.1.102.1       YES unset  up                    up\nLoopback65528          192.168.1.1     YES other  up                    up\nNVI0                   unassigned      YES unset  up                    up\nTunnel1                172.2.7.2       YES TFTP   up                    up\nTunnel2                172.3.9.7       YES TFTP   up                    up\nTunnel100001           172.4.102.1     YES other  up                    up\nR2-WE1#  R1-WE1#sh ip int b\nInterface              IP-Address      OK? Method Status                Protocol\nGigabitEthernet1       172.1.8.2       YES other  up                    up\nGigabitEthernet2       172.3.8.7       YES DHCP   up                    up\nGigabitEthernet3       10.10.101.1     YES other  up                    up\nGigabitEthernet4       unassigned      YES other  down                  down\nGigabitEthernet5       unassigned      YES other  down                  down\nGigabitEthernet6       unassigned      YES other  down                  down\nGigabitEthernet7       unassigned      YES other  down                  down\nGigabitEthernet8       192.168.150.16  YES other  up                    up\nSdwan-system-intf      1.1.100.1       YES unset  up                    up\nLoopback65528          192.168.1.1     YES other  up                    up\nNVI0                   unassigned      YES unset  up                    up\nTunnel1                172.1.8.2       YES TFTP   up                    up\nTunnel2                172.3.8.7       YES TFTP   up                    up\nTunnel100001           172.4.101.1     YES other  up                    up\nR1-WE1#   Next you need to route all traffic to cloud application  16.16.16.16  to the tunnel.  locate feature template  Lab_Remote_VPN1_V01  and edit  In  IPSEC ROUTE  section, add  New IPSEC Route  with prefix  16.16.16.16/32  interface  ipsec1     click update to push configure change to both remote sites.",
            "title": "Step4.1 : Manual IPSec tunnel to SIG"
        },
        {
            "location": "/lab3/#step42-verify-sig-tunnel",
            "text": "VNC login  R1-VM1  and  R2-VM1  with credential  viptela    verify that you can ping  16.16.16.16  from the VM\n     now try access  16.16.16.16  from browser. You should see this login page",
            "title": "Step4.2 : verify SIG tunnel"
        },
        {
            "location": "/lab3/#task-5-dia",
            "text": "There are two options to enable DIA.\n- option 1: NAT DIA Route  In this option, a NAT route is configured under service VPN. You can direct local internet traffic from service VPN to transport VPN.\n- option 2: Centralized data policy\n    In this option, a centralized policy is applied to service side traffic based on ip prefixes, a match will redirect to transport VPN. Traffic that doesnt match the policy will stay in service VPN and route over IPSec tunnel.  In this task, you are going to configure DIA on remote sites using option 2.",
            "title": "Task 5: DIA"
        },
        {
            "location": "/lab3/#task-6-cor-for-saas",
            "text": "Instead of using the DIA exit point as configured in previous task, for SaaS application box and salesforce, ACME wants to use the most optimal path. Configure the remote sites to dynamically chose local DIA or regional hub as exit point for box and salesforce based on application performance.",
            "title": "Task 6: CoR for SaaS"
        },
        {
            "location": "/lab3/#step61-enable-cloud-onramp-for-saas",
            "text": "login vManage  198.18.133.200  and access  Administration - Settings  Edit  Cloud onRamp for SaaS  and check  Enabled",
            "title": "Step6.1 Enable Cloud OnRamp for SaaS"
        },
        {
            "location": "/lab3/#step62-add-saas-application",
            "text": "Access CoR SaaS configuration via  Configuration - Cloud onRamp for SaaS      From  Manage Cloud OnRamp for SaaS  dropdown, select  Applications and Policy \n      Select  Box  and  Salesforce  from the application list; Select  Enabled  for Monitoring dropdown list; Enter  1  for VPN; Select  Enabled  for Policy/Cloud SLA dropdown list.    \n- Cloud OnRamp for SaaS uses existing AAR policy, we will keep the system created policy for SaaS. Click  Save Policy  to proceed the policy update.",
            "title": "Step6.2 Add SaaS application"
        },
        {
            "location": "/lab3/#step63-add-sites",
            "text": "You are going to configure remote sites as DIA site, and Regional hub as gateway site. Remote sites will monitor the QoE score for local DIA via LTE transport, and also the QoE score for gateway site.\n- Access CoR SaaS configuration via  Configuration - Cloud onRamp for SaaS \n- Click  Manage Cloud OnRamp for SaaS  dropdown list on the upper left, and select  Gateway \n   \n- Click  Attach Gateways ,  select  RH-WE1  and move it to  selected Sites . Click  Add interfaces to selected sites .\n   \n- In the pop up window, under  Interface  field select interface  GigabitEthernet4  from the list. This will allow gateway site sends \n    \n- Click  Manage Cloud OnRamp for SaaS  dropdown list on the upper left, and select  DIA Sites \n    \n- select  Attach DIA Sites , select  R1-WE1  and  R2-WE1  and move it to  selected Sites .",
            "title": "Step6.3 Add sites"
        },
        {
            "location": "/lab3/#step64-verify-cor-saas",
            "text": "Click  Manage Cloud OnRamp for SaaS  to verify QoE status, DIA status, exit interface on each WAN Edge for SaaS application.   \n     Note: Your output may not match the screenshot on the vQoE score and DIA Status. This is expected. \n- screenshot above shows both remote sites are using local DIA as exit point for box and Salesfoce SaaS application.\n- This lab doesn't have traffic impairment tool, we can't increase remote transport's latency or drop to trigger SaaS changes exit point. But if you keep checking the SaaS status, you will notice the vQoE score changes and exit interface changes.",
            "title": "Step6.4 Verify CoR SaaS"
        },
        {
            "location": "/lab3/#congratulation-you-have-completed-the-whole-lab",
            "text": "Back to Top",
            "title": "Congratulation! You have completed the whole lab."
        },
        {
            "location": "/survey/",
            "text": "",
            "title": "Survey"
        }
    ]
}